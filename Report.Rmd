---
title: "Predicting UFC Fight Results"
output:
  pdf_document: default
  html_document:
date: "2023-12-11"
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE, 
                      warning = FALSE, 
                      fig.height = 3, 
                      fig.width = 5)
```

```{r}
library(ggplot2)
library(readr)
library(dplyr)
library(knitr)
library(ggplot2)
library(lubridate)
library(purrr)
library(randomForest)
library(caret)
library(patchwork)
library(kableExtra)
library(car)
library(pROC)
library(e1071)
library(glmnet)
library(leaps)

data <- read_csv("data.csv")
data$R_Stance <- ifelse(data$R_Stance == "Open Stance", gsub(" ", "", data$R_Stance), data$R_Stance)
data$B_Stance <- ifelse(data$B_Stance == "Open Stance", gsub(" ", "", data$B_Stance), data$B_Stance)


```
## Introduction 

The UFC began as a professional mixed martial arts organization in 1993 serving as an alternative hand-to-hand combat sport that combined traditional boxing with wrestling, karate, kickboxing, and jiu-jistu fighting techniques. The entity was acquired by a group led by Dana White in 2001, who has served as the President for over two decades. Since estabilshing control, Dana White has exponentially grown the reach of UFC's product while also creating more structure and sanction to the sport of MMA. UFC currently has over 60 global broadcasting partners and is able to be accessed in over 165 different countries. With a traveling, tour-like model, the UFC has been able to sell-out many arenas across the world as equally become a highly-touted event to attend similar to boxing matches with well-known participants involved. 

In many other North-american based sports, organizations have invested and founded their own analytics departments. These departments are responsible for using data to acquire and develop the right talent that will lead to on-field success and improve the team's product. Since the UFC's participants are individual fighters that often follow their own training regiment, there is a smaller focus on analytics within the sport.   

The purpose of our project is to create a model that maximizes predictive accuracy for the purposes of assisting sports bettors in finding potential opportunities for value not seen by the public. Dana White and the UFC have fully embraced the recent popularity of sports betting, forming sponsorships with companies such as bet365 in the UK, DraftKings in the US, as well as many others located worldwide. There is an established market for sports betting in the UFC, and we hope to create a model that provides an estimation of a winner between two fighters along with some form of uncertainty that allows a sports-better to determine if the predicted odds over or under-estimate a fighter's chance of winning compared to the sportsbook odds given to the public. 

Our data is each UFC fight from 1994-2021, containing each fighter's names, physical information (age, height, weight), the amount of wins and losses in their UFC history, and various fighting data. The fighting data includes the average amount of attempted and landed attacks over their UFC career, as well as the frequency of different types of attacks they have faced from their previous opponents. We plan to fit an elastic net model that incorporates the standardization of a ridge regression model, and the variable selection of a lasso regression model, to determine which predictors in our dataset are most influential. Our response variable will be the winner in each fight, with that value randomized dependent on the color of the corner assigned during the fight (red or blue). The estimated probability values from the elastic net model can be compared against the moneyline odds to determine estimated value for sports bettors. 


## Data Description and EDA

The dataset used for modeling was initially sourced from ufcstats.com, where the data was processed and published on kaggle.com. The dataset contains roughly 6,012 unique fights over a 27 year span, with each row containing data on fighters in the red and blue corner, a universal classification system used throughout all rows. Since a given fighter could be in the red corner for one fight and in the blue corner for another, we don't place any value in the classification. The historical data for a given strike is split into four different columns. There is a separate column for the average amount of attempt and the average amount of strikes landed for a fighter's prior fight. Additionally, for that given strike there includes identical metrics for the averages of their prior opponents. For example, if Conor McGregor had one prior fight in which his opponent attempted 20 strikes to Conor's head and connected on 8, the row for Conor's second fight would display avg_opp_HEAD_att equal to 20 and avg_opp_HEAD_landed to 8.

In the UFC, fighters can win in a variety of different ways. If both fighters are still standing at the end of the fighter, the judges will issue a decision that is either unanimous, split, or a majority decision. The dataset includes the amount of victories by each form of decision, as well as by knockout or by the on-hand doctor stopping the fight. Our dataset also provides the current winning or losing streak for each fighter, which can be useful as it can reflect the momentum and confidence a fighter may possess. 

```{r}
#data %>% group_by(weight_class) %>% summarise(count = n())
```

```{r}
data <- data %>%
  mutate(fight_gender = ifelse(weight_class %in% c("WomenBantamweight", "WomenFeatherweight", "WomenFlyweight",
                                             "WomenStrawweight"), "women", "men"))

p1 <- ggplot(data = data, aes(x = fight_gender)) + geom_bar()
p2 <- ggplot(data = data, aes(x = Winner)) + geom_bar()

p1 + p2
```


The plots above provide a better idea on the breakdown of the amount of male and female fights in UFC's history, as well as the results based on which corner was victorious. Similar to men's and women's lacrosse or men's and women's soccer, we believe that men's and women's UFC fights should be considered different sports given the difference in fighting style. Men's MMA is centered around  wrestling, while women's MMA is centered around jiu-jitsu and judo with a strong preference for striking than grappling seen more commonly on the men's side. Since roughly 92% of the data are men's UFC fights, we will remove the observations in which the two fighters are female. The right plot above reveals that about 2/3 of fights with a winner are assigned to the red corner. Since the corners are simply a classifier and we are conerned that our models will be biased towards the red corner, we will randomize the fighters within each fight and reassign their corresponding statistics if necessary. 

Another limitation within our data is that for a fighter's first career UFC fight, they have no historical data and thus their respective columns are N/A in our dataset. Since our modeling techniques require clean data without missing data, we will need to remove instances of a fighter's first fight.

```{r}
data <- data %>%
  mutate(first_fight = ifelse(is.na(B_avg_KD) | is.na(R_avg_KD), "yes", "no"))
ggplot(data = data, aes(x = first_fight)) + geom_bar() + labs(title = "Calculating Instances of a Fighter's 1st Fight")
```





```{r, eval = FALSE}
data$date <- as.Date(data$date, format = "%m/%d/%y")

# Extract year from the Date column
data$year <- as.numeric(format(data$date, "%Y"))


year_freq <- data %>% group_by(year) %>% summarize(count = n()) 

ggplot(data = year_freq, mapping = aes(x = year, y = count)) + geom_line() + labs(x = "Year", y = "Number of Fights", title = "Trend of Number of Fights in the UFC")

```

```{r}
# Filtering for only men's fights and eliminating CatchWeight
data2 <- data %>%
  filter(fight_gender == "men" & first_fight == "no" & weight_class != "CatchWeight" & Winner != "Draw")
#nrow(data2)
```




```{r}
#randomizing blue and red
data2 <- data2 %>%
  mutate(Winner2 = ifelse(Winner == "Red", R_fighter, B_fighter)) %>%
  rename(B_avg_CTRL_time.seconds. = `B_avg_CTRL_time(seconds)`,
         B_avg_opp_CTRL_time.seconds. = `B_avg_opp_CTRL_time(seconds)`,
         B_total_time_fought.seconds. = `B_total_time_fought(seconds)`,
         B_win_by_KO.TKO = `B_win_by_KO/TKO`,
         R_avg_CTRL_time.seconds. = `R_avg_CTRL_time(seconds)`,
         R_avg_opp_CTRL_time.seconds. = `R_avg_opp_CTRL_time(seconds)`,
         R_total_time_fought.seconds. = `R_total_time_fought(seconds)`,
         R_win_by_KO.TKO = `R_win_by_KO/TKO`)
```



```{r}
set.seed(12)
shuffle_fighters <- function(B_fighter, B_avg_KD, B_avg_opp_KD, B_avg_SIG_STR_pct, B_avg_opp_SIG_STR_pct,
                             B_avg_TD_pct,B_avg_opp_TD_pct, B_avg_SUB_ATT, 
                             B_avg_opp_SUB_ATT, B_avg_REV, B_avg_opp_REV, 
                             B_avg_SIG_STR_att, B_avg_SIG_STR_landed, 
                             B_avg_opp_SIG_STR_att,B_avg_opp_SIG_STR_landed, 
                             B_avg_TOTAL_STR_att, B_avg_TOTAL_STR_landed,
                             B_avg_opp_TOTAL_STR_att, B_avg_opp_TOTAL_STR_landed, 
                             B_avg_TD_att, B_avg_TD_landed, B_avg_opp_TD_att, 
                             B_avg_opp_TD_landed, B_avg_HEAD_att,
                             B_avg_HEAD_landed, B_avg_opp_HEAD_att, 
                             B_avg_opp_HEAD_landed, B_avg_BODY_att,
                             B_avg_BODY_landed, B_avg_opp_BODY_att, 
                             B_avg_opp_BODY_landed, B_avg_LEG_att, 
                             B_avg_LEG_landed, B_avg_opp_LEG_att, 
                             B_avg_opp_LEG_landed, B_avg_DISTANCE_att,
                             B_avg_DISTANCE_landed, B_avg_opp_DISTANCE_att, 
                             B_avg_opp_DISTANCE_landed,B_avg_CLINCH_att, 
                             B_avg_CLINCH_landed, B_avg_opp_CLINCH_att, 
                             B_avg_opp_CLINCH_landed, B_avg_GROUND_att, B_avg_GROUND_landed,
                             B_avg_opp_GROUND_att, B_avg_opp_GROUND_landed, B_avg_CTRL_time.seconds.,
                             B_avg_opp_CTRL_time.seconds., B_total_time_fought.seconds., 
                             B_total_rounds_fought, B_total_title_bouts, B_current_win_streak, 
                             B_current_lose_streak, B_longest_win_streak, B_wins, B_losses, B_draw,
                             B_win_by_Decision_Majority, B_win_by_Decision_Split,
                             B_win_by_Decision_Unanimous, B_win_by_KO.TKO, B_win_by_Submission,
                             B_win_by_TKO_Doctor_Stoppage, B_Stance, B_Height_cms, B_Reach_cms, B_Weight_lbs,
                             B_age, R_fighter, R_avg_KD, R_avg_opp_KD, R_avg_SIG_STR_pct, 
                             R_avg_opp_SIG_STR_pct, R_avg_TD_pct, R_avg_opp_TD_pct, R_avg_SUB_ATT, 
                             R_avg_opp_SUB_ATT, R_avg_REV, R_avg_opp_REV, R_avg_SIG_STR_att, 
                             R_avg_SIG_STR_landed, R_avg_opp_SIG_STR_att,
                             R_avg_opp_SIG_STR_landed, R_avg_TOTAL_STR_att, R_avg_TOTAL_STR_landed,
                             R_avg_opp_TOTAL_STR_att, R_avg_opp_TOTAL_STR_landed, R_avg_TD_att,
                             R_avg_TD_landed, R_avg_opp_TD_att, R_avg_opp_TD_landed, R_avg_HEAD_att,
                             R_avg_HEAD_landed, R_avg_opp_HEAD_att, R_avg_opp_HEAD_landed, R_avg_BODY_att,
                             R_avg_BODY_landed, R_avg_opp_BODY_att, R_avg_opp_BODY_landed, R_avg_LEG_att,
                             R_avg_LEG_landed, R_avg_opp_LEG_att, R_avg_opp_LEG_landed, R_avg_DISTANCE_att,
                             R_avg_DISTANCE_landed, R_avg_opp_DISTANCE_att, R_avg_opp_DISTANCE_landed,
                             R_avg_CLINCH_att, R_avg_CLINCH_landed, R_avg_opp_CLINCH_att,
                             R_avg_opp_CLINCH_landed, R_avg_GROUND_att, R_avg_GROUND_landed,
                             R_avg_opp_GROUND_att, R_avg_opp_GROUND_landed, R_avg_CTRL_time.seconds.,
                             R_avg_opp_CTRL_time.seconds., R_total_time_fought.seconds.,
                             R_total_rounds_fought, R_total_title_bouts, R_current_win_streak,
                             R_current_lose_streak, R_longest_win_streak, R_wins, R_losses, R_draw,
                             R_win_by_Decision_Majority, R_win_by_Decision_Split,
                             R_win_by_Decision_Unanimous, R_win_by_KO.TKO, R_win_by_Submission,
                             R_win_by_TKO_Doctor_Stoppage, R_Stance, R_Height_cms, R_Reach_cms,
                             R_Weight_lbs, R_age) {
  if (runif(1) < 0.5) {
    return(c(B_fighter, B_avg_KD, B_avg_opp_KD, 
                             B_avg_SIG_STR_pct, B_avg_opp_SIG_STR_pct, 
                             B_avg_TD_pct,B_avg_opp_TD_pct, B_avg_SUB_ATT, 
                             B_avg_opp_SUB_ATT, B_avg_REV, B_avg_opp_REV, 
                             B_avg_SIG_STR_att, B_avg_SIG_STR_landed, 
                             B_avg_opp_SIG_STR_att,B_avg_opp_SIG_STR_landed, 
                             B_avg_TOTAL_STR_att, B_avg_TOTAL_STR_landed,
                             B_avg_opp_TOTAL_STR_att, B_avg_opp_TOTAL_STR_landed, 
                             B_avg_TD_att, B_avg_TD_landed, B_avg_opp_TD_att, 
                             B_avg_opp_TD_landed, B_avg_HEAD_att,
                             B_avg_HEAD_landed, B_avg_opp_HEAD_att, 
                             B_avg_opp_HEAD_landed, B_avg_BODY_att,
                             B_avg_BODY_landed, B_avg_opp_BODY_att, 
                             B_avg_opp_BODY_landed, B_avg_LEG_att, 
                             B_avg_LEG_landed, B_avg_opp_LEG_att, 
                             B_avg_opp_LEG_landed, B_avg_DISTANCE_att,
                             B_avg_DISTANCE_landed, B_avg_opp_DISTANCE_att, 
                             B_avg_opp_DISTANCE_landed,B_avg_CLINCH_att, 
                             B_avg_CLINCH_landed, B_avg_opp_CLINCH_att, 
                             B_avg_opp_CLINCH_landed, B_avg_GROUND_att, B_avg_GROUND_landed,
                             B_avg_opp_GROUND_att, B_avg_opp_GROUND_landed, B_avg_CTRL_time.seconds.,
                             B_avg_opp_CTRL_time.seconds., B_total_time_fought.seconds., 
                             B_total_rounds_fought, B_total_title_bouts, B_current_win_streak, 
                             B_current_lose_streak, B_longest_win_streak, B_wins, B_losses, B_draw,
                             B_win_by_Decision_Majority, B_win_by_Decision_Split,
                             B_win_by_Decision_Unanimous, B_win_by_KO.TKO, B_win_by_Submission,
                             B_win_by_TKO_Doctor_Stoppage, B_Stance, B_Height_cms, B_Reach_cms, B_Weight_lbs,
                             B_age, R_fighter, R_avg_KD, R_avg_opp_KD, R_avg_SIG_STR_pct, 
                             R_avg_opp_SIG_STR_pct, R_avg_TD_pct, R_avg_opp_TD_pct, R_avg_SUB_ATT, 
                             R_avg_opp_SUB_ATT, R_avg_REV, R_avg_opp_REV, R_avg_SIG_STR_att, 
                             R_avg_SIG_STR_landed, R_avg_opp_SIG_STR_att,
                             R_avg_opp_SIG_STR_landed, R_avg_TOTAL_STR_att, R_avg_TOTAL_STR_landed,
                             R_avg_opp_TOTAL_STR_att, R_avg_opp_TOTAL_STR_landed, R_avg_TD_att,
                             R_avg_TD_landed, R_avg_opp_TD_att, R_avg_opp_TD_landed, R_avg_HEAD_att,
                             R_avg_HEAD_landed, R_avg_opp_HEAD_att, R_avg_opp_HEAD_landed, R_avg_BODY_att,
                             R_avg_BODY_landed, R_avg_opp_BODY_att, R_avg_opp_BODY_landed, R_avg_LEG_att,
                             R_avg_LEG_landed, R_avg_opp_LEG_att, R_avg_opp_LEG_landed, R_avg_DISTANCE_att,
                             R_avg_DISTANCE_landed, R_avg_opp_DISTANCE_att, R_avg_opp_DISTANCE_landed,
                             R_avg_CLINCH_att, R_avg_CLINCH_landed, R_avg_opp_CLINCH_att,
                             R_avg_opp_CLINCH_landed, R_avg_GROUND_att, R_avg_GROUND_landed,
                             R_avg_opp_GROUND_att, R_avg_opp_GROUND_landed, R_avg_CTRL_time.seconds.,
                             R_avg_opp_CTRL_time.seconds., R_total_time_fought.seconds.,
                             R_total_rounds_fought, R_total_title_bouts, R_current_win_streak,
                             R_current_lose_streak, R_longest_win_streak, R_wins, R_losses, R_draw,
                             R_win_by_Decision_Majority, R_win_by_Decision_Split,
                             R_win_by_Decision_Unanimous, R_win_by_KO.TKO, R_win_by_Submission,
                             R_win_by_TKO_Doctor_Stoppage, R_Stance, R_Height_cms, R_Reach_cms,
                             R_Weight_lbs, R_age))
  } else {
    return(c(R_fighter, R_avg_KD, R_avg_opp_KD, 
                             R_avg_SIG_STR_pct, R_avg_opp_SIG_STR_pct, 
                             R_avg_TD_pct, R_avg_opp_TD_pct, R_avg_SUB_ATT, 
                             R_avg_opp_SUB_ATT, R_avg_REV, R_avg_opp_REV, 
                             R_avg_SIG_STR_att, R_avg_SIG_STR_landed, 
                             R_avg_opp_SIG_STR_att, R_avg_opp_SIG_STR_landed, 
                             R_avg_TOTAL_STR_att, R_avg_TOTAL_STR_landed,
                             R_avg_opp_TOTAL_STR_att, R_avg_opp_TOTAL_STR_landed, 
                             R_avg_TD_att, R_avg_TD_landed, R_avg_opp_TD_att, 
                             R_avg_opp_TD_landed, R_avg_HEAD_att,
                             R_avg_HEAD_landed, R_avg_opp_HEAD_att, 
                             R_avg_opp_HEAD_landed, R_avg_BODY_att,
                             R_avg_BODY_landed, R_avg_opp_BODY_att, 
                             R_avg_opp_BODY_landed, R_avg_LEG_att, 
                             R_avg_LEG_landed, R_avg_opp_LEG_att, 
                             R_avg_opp_LEG_landed, R_avg_DISTANCE_att,
                             R_avg_DISTANCE_landed, R_avg_opp_DISTANCE_att, 
                             R_avg_opp_DISTANCE_landed, R_avg_CLINCH_att, 
                             R_avg_CLINCH_landed, R_avg_opp_CLINCH_att, 
                             R_avg_opp_CLINCH_landed, R_avg_GROUND_att, R_avg_GROUND_landed,
                             R_avg_opp_GROUND_att, R_avg_opp_GROUND_landed, R_avg_CTRL_time.seconds.,
                             R_avg_opp_CTRL_time.seconds., R_total_time_fought.seconds., 
                             R_total_rounds_fought, R_total_title_bouts, R_current_win_streak, 
                             R_current_lose_streak, R_longest_win_streak, R_wins, R_losses, R_draw,
                             R_win_by_Decision_Majority, R_win_by_Decision_Split,
                             R_win_by_Decision_Unanimous, R_win_by_KO.TKO, R_win_by_Submission,
                             R_win_by_TKO_Doctor_Stoppage, R_Stance, R_Height_cms, R_Reach_cms, R_Weight_lbs,
                             R_age, B_fighter, B_avg_KD, B_avg_opp_KD, B_avg_SIG_STR_pct, 
                             B_avg_opp_SIG_STR_pct, B_avg_TD_pct, B_avg_opp_TD_pct, B_avg_SUB_ATT, 
                             B_avg_opp_SUB_ATT, B_avg_REV, B_avg_opp_REV, B_avg_SIG_STR_att, 
                             B_avg_SIG_STR_landed, B_avg_opp_SIG_STR_att,
                             B_avg_opp_SIG_STR_landed, B_avg_TOTAL_STR_att, B_avg_TOTAL_STR_landed,
                             B_avg_opp_TOTAL_STR_att, B_avg_opp_TOTAL_STR_landed, B_avg_TD_att,
                             B_avg_TD_landed, B_avg_opp_TD_att, B_avg_opp_TD_landed, B_avg_HEAD_att,
                             B_avg_HEAD_landed, B_avg_opp_HEAD_att, B_avg_opp_HEAD_landed, B_avg_BODY_att,
                             B_avg_BODY_landed, B_avg_opp_BODY_att, B_avg_opp_BODY_landed, B_avg_LEG_att,
                             B_avg_LEG_landed, B_avg_opp_LEG_att, B_avg_opp_LEG_landed, B_avg_DISTANCE_att,
                             B_avg_DISTANCE_landed, B_avg_opp_DISTANCE_att, B_avg_opp_DISTANCE_landed,
                             B_avg_CLINCH_att, B_avg_CLINCH_landed, B_avg_opp_CLINCH_att,
                             B_avg_opp_CLINCH_landed, B_avg_GROUND_att, B_avg_GROUND_landed,
                             B_avg_opp_GROUND_att, B_avg_opp_GROUND_landed, B_avg_CTRL_time.seconds.,
                             B_avg_opp_CTRL_time.seconds., B_total_time_fought.seconds.,
                             B_total_rounds_fought, B_total_title_bouts, B_current_win_streak,
                             B_current_lose_streak, B_longest_win_streak, B_wins, B_losses, B_draw,
                             B_win_by_Decision_Majority, B_win_by_Decision_Split,
                             B_win_by_Decision_Unanimous, B_win_by_KO.TKO, B_win_by_Submission,
                             B_win_by_TKO_Doctor_Stoppage, B_Stance, B_Height_cms, B_Reach_cms,
                             B_Weight_lbs, B_age))
  }
}
```


```{r}
set.seed(12)
ufc_data_shuffled <- data2 %>%
  rowwise() %>%
  mutate(shuffled_data = list(shuffle_fighters(B_fighter, B_avg_KD, B_avg_opp_KD, B_avg_SIG_STR_pct,
                                               B_avg_opp_SIG_STR_pct,B_avg_TD_pct,B_avg_opp_TD_pct, B_avg_SUB_ATT,
                                               B_avg_opp_SUB_ATT, B_avg_REV, B_avg_opp_REV, 
                                               B_avg_SIG_STR_att, B_avg_SIG_STR_landed,
                                               B_avg_opp_SIG_STR_att,B_avg_opp_SIG_STR_landed, 
                                               B_avg_TOTAL_STR_att, B_avg_TOTAL_STR_landed,
                                               B_avg_opp_TOTAL_STR_att, B_avg_opp_TOTAL_STR_landed, 
                                               B_avg_TD_att, B_avg_TD_landed, B_avg_opp_TD_att, 
                                               B_avg_opp_TD_landed, B_avg_HEAD_att,
                                               B_avg_HEAD_landed, B_avg_opp_HEAD_att, 
                                               B_avg_opp_HEAD_landed, B_avg_BODY_att,
                                               B_avg_BODY_landed, B_avg_opp_BODY_att, 
                                               B_avg_opp_BODY_landed, B_avg_LEG_att, 
                                               B_avg_LEG_landed, B_avg_opp_LEG_att, 
                                               B_avg_opp_LEG_landed, B_avg_DISTANCE_att,
                                               B_avg_DISTANCE_landed, B_avg_opp_DISTANCE_att, 
                                               B_avg_opp_DISTANCE_landed,B_avg_CLINCH_att, 
                                               B_avg_CLINCH_landed, B_avg_opp_CLINCH_att,
                                               B_avg_opp_CLINCH_landed, B_avg_GROUND_att, B_avg_GROUND_landed,
                                               B_avg_opp_GROUND_att, B_avg_opp_GROUND_landed, B_avg_CTRL_time.seconds.,
                                               B_avg_opp_CTRL_time.seconds., B_total_time_fought.seconds.,
                                               B_total_rounds_fought, B_total_title_bouts, B_current_win_streak,
                                               B_current_lose_streak, B_longest_win_streak, B_wins, B_losses, B_draw,
                                               B_win_by_Decision_Majority, B_win_by_Decision_Split,
                                               B_win_by_Decision_Unanimous, B_win_by_KO.TKO, B_win_by_Submission,
                                               B_win_by_TKO_Doctor_Stoppage, B_Stance, B_Height_cms, B_Reach_cms,
                                               B_Weight_lbs, B_age, R_fighter, R_avg_KD, R_avg_opp_KD, 
                                               R_avg_SIG_STR_pct, 
                                               R_avg_opp_SIG_STR_pct, R_avg_TD_pct, R_avg_opp_TD_pct, R_avg_SUB_ATT, 
                                               R_avg_opp_SUB_ATT, R_avg_REV, R_avg_opp_REV, R_avg_SIG_STR_att, 
                                               R_avg_SIG_STR_landed, R_avg_opp_SIG_STR_att,
                                               R_avg_opp_SIG_STR_landed, R_avg_TOTAL_STR_att, R_avg_TOTAL_STR_landed,
                                               R_avg_opp_TOTAL_STR_att, R_avg_opp_TOTAL_STR_landed, R_avg_TD_att,
                                               R_avg_TD_landed, R_avg_opp_TD_att, R_avg_opp_TD_landed, R_avg_HEAD_att,
                                               R_avg_HEAD_landed, R_avg_opp_HEAD_att, R_avg_opp_HEAD_landed,
                                               R_avg_BODY_att,
                                               R_avg_BODY_landed, R_avg_opp_BODY_att, R_avg_opp_BODY_landed,
                                               R_avg_LEG_att,
                                               R_avg_LEG_landed, R_avg_opp_LEG_att, R_avg_opp_LEG_landed,
                                               R_avg_DISTANCE_att,
                                               R_avg_DISTANCE_landed, R_avg_opp_DISTANCE_att, R_avg_opp_DISTANCE_landed,
                                               R_avg_CLINCH_att, R_avg_CLINCH_landed, R_avg_opp_CLINCH_att,
                                               R_avg_opp_CLINCH_landed, R_avg_GROUND_att, R_avg_GROUND_landed,
                                               R_avg_opp_GROUND_att, R_avg_opp_GROUND_landed, R_avg_CTRL_time.seconds.,
                                               R_avg_opp_CTRL_time.seconds., R_total_time_fought.seconds.,
                                               R_total_rounds_fought, R_total_title_bouts, R_current_win_streak,
                                               R_current_lose_streak, R_longest_win_streak, R_wins, R_losses, R_draw,
                                               R_win_by_Decision_Majority, R_win_by_Decision_Split,
                                               R_win_by_Decision_Unanimous, R_win_by_KO.TKO, R_win_by_Submission,
                                               R_win_by_TKO_Doctor_Stoppage, R_Stance, R_Height_cms, R_Reach_cms,
                                               R_Weight_lbs, R_age))) %>%
  ungroup()
```


```{r}
set.seed(12)
ufc_data_shuffled <- ufc_data_shuffled %>%
  mutate(B_fighter = map_chr(shuffled_data, 1),
         B_avg_KD = map_chr(shuffled_data, 2),
         B_avg_opp_KD = map_chr(shuffled_data, 3),
         B_avg_SIG_STR_pct = map_chr(shuffled_data, 4),
         B_avg_opp_SIG_STR_pct = map_chr(shuffled_data, 5),
         B_avg_TD_pct = map_chr(shuffled_data, 6),
         B_avg_opp_TD_pct = map_chr(shuffled_data, 7),
         B_avg_SUB_ATT = map_chr(shuffled_data, 8),
         B_avg_opp_SUB_ATT = map_chr(shuffled_data, 9),
         B_avg_REV = map_chr(shuffled_data, 10),
         B_avg_opp_REV = map_chr(shuffled_data, 11),
         B_avg_SIG_STR_att = map_chr(shuffled_data, 12),
         B_avg_SIG_STR_landed = map_chr(shuffled_data, 13),
         B_avg_opp_SIG_STR_att = map_chr(shuffled_data, 14),
         B_avg_opp_SIG_STR_landed = map_chr(shuffled_data, 15),
         B_avg_TOTAL_STR_att = map_chr(shuffled_data, 16),
         B_avg_TOTAL_STR_landed = map_chr(shuffled_data, 17),
         B_avg_opp_TOTAL_STR_att = map_chr(shuffled_data, 18),
         B_avg_opp_TOTAL_STR_landed = map_chr(shuffled_data, 19),
         B_avg_TD_att = map_chr(shuffled_data, 20),
         B_avg_TD_landed = map_chr(shuffled_data, 21),
         B_avg_opp_TD_att = map_chr(shuffled_data, 22),
         B_avg_opp_TD_landed = map_chr(shuffled_data, 23),
         B_avg_HEAD_att = map_chr(shuffled_data, 24),
         B_avg_HEAD_landed = map_chr(shuffled_data, 25),
         B_avg_opp_HEAD_att = map_chr(shuffled_data, 26),
         B_avg_opp_HEAD_landed = map_chr(shuffled_data, 27),
         B_avg_BODY_att = map_chr(shuffled_data, 28),
         B_avg_BODY_landed = map_chr(shuffled_data, 29),
         B_avg_opp_BODY_att = map_chr(shuffled_data, 30),
         B_avg_opp_BODY_landed = map_chr(shuffled_data, 31),
         B_avg_LEG_att = map_chr(shuffled_data, 32),
         B_avg_LEG_landed = map_chr(shuffled_data, 33),
         B_avg_opp_LEG_att = map_chr(shuffled_data, 34),
         B_avg_opp_LEG_landed = map_chr(shuffled_data, 35),
         B_avg_DISTANCE_att = map_chr(shuffled_data, 36),
         B_avg_DISTANCE_landed = map_chr(shuffled_data, 37),
         B_avg_opp_DISTANCE_att = map_chr(shuffled_data, 38),
         B_avg_opp_DISTANCE_landed = map_chr(shuffled_data, 39),
         B_avg_CLINCH_att = map_chr(shuffled_data, 40),
         B_avg_CLINCH_landed = map_chr(shuffled_data, 41),
         B_avg_opp_CLINCH_att = map_chr(shuffled_data, 42),
         B_avg_opp_CLINCH_landed = map_chr(shuffled_data, 43),
         B_avg_GROUND_att = map_chr(shuffled_data, 44),
         B_avg_GROUND_landed = map_chr(shuffled_data, 45),
         B_avg_opp_GROUND_att = map_chr(shuffled_data, 46),
         B_avg_opp_GROUND_landed = map_chr(shuffled_data, 47),
         B_avg_CTRL_time.seconds. = map_chr(shuffled_data, 48),
         B_avg_opp_CTRL_time.seconds. = map_chr(shuffled_data, 49),
         B_total_time_fought.seconds. = map_chr(shuffled_data, 50),
         B_total_rounds_fought = map_chr(shuffled_data, 51),
         B_total_title_bouts = map_chr(shuffled_data, 52),
         B_current_win_streak = map_chr(shuffled_data, 53),
         B_current_lose_streak = map_chr(shuffled_data, 54),
         B_longest_win_streak = map_chr(shuffled_data, 55),
         B_wins = map_chr(shuffled_data, 56),
         B_losses = map_chr(shuffled_data, 57),
         B_draw = map_chr(shuffled_data, 58),
         B_win_by_Decision_Majority = map_chr(shuffled_data, 59),
         B_win_by_Decision_Split = map_chr(shuffled_data, 60),
         B_win_by_Decision_Unanimous = map_chr(shuffled_data, 61),
         B_win_by_KO.TKO = map_chr(shuffled_data, 62),
         B_win_by_Submission = map_chr(shuffled_data, 63),
         B_win_by_TKO_Doctor_Stoppage = map_chr(shuffled_data, 64),
         B_Stance = map_chr(shuffled_data, 65),
         B_Height_cms = map_chr(shuffled_data, 66),
         B_Reach_cms = map_chr(shuffled_data, 67),
         B_Weight_lbs = map_chr(shuffled_data, 68),
         B_age = map_chr(shuffled_data, 69),
         R_fighter = map_chr(shuffled_data, 70),
         R_avg_KD = map_chr(shuffled_data, 71),
         R_avg_opp_KD = map_chr(shuffled_data, 72),
         R_avg_SIG_STR_pct = map_chr(shuffled_data, 73),
         R_avg_opp_SIG_STR_pct = map_chr(shuffled_data, 74),
         R_avg_TD_pct = map_chr(shuffled_data, 75),
         R_avg_opp_TD_pct = map_chr(shuffled_data, 76),
         R_avg_SUB_ATT = map_chr(shuffled_data, 77),
         R_avg_opp_SUB_ATT = map_chr(shuffled_data, 78),
         R_avg_REV = map_chr(shuffled_data, 79),
         R_avg_opp_REV = map_chr(shuffled_data, 80),
         R_avg_SIG_STR_att = map_chr(shuffled_data, 81),
         R_avg_SIG_STR_landed = map_chr(shuffled_data, 82),
         R_avg_opp_SIG_STR_att = map_chr(shuffled_data, 83),
         R_avg_opp_SIG_STR_landed = map_chr(shuffled_data, 84),
         R_avg_TOTAL_STR_att = map_chr(shuffled_data, 85),
         R_avg_TOTAL_STR_landed = map_chr(shuffled_data, 86),
         R_avg_opp_TOTAL_STR_att = map_chr(shuffled_data, 87),
         R_avg_opp_TOTAL_STR_landed = map_chr(shuffled_data, 88),
         R_avg_TD_att = map_chr(shuffled_data, 89),
         R_avg_TD_landed = map_chr(shuffled_data, 90),
         R_avg_opp_TD_att = map_chr(shuffled_data, 91),
         R_avg_opp_TD_landed = map_chr(shuffled_data, 92),
         R_avg_HEAD_att = map_chr(shuffled_data, 93),
         R_avg_HEAD_landed = map_chr(shuffled_data, 94),
         R_avg_opp_HEAD_att = map_chr(shuffled_data, 95),
         R_avg_opp_HEAD_landed = map_chr(shuffled_data, 96),
         R_avg_BODY_att = map_chr(shuffled_data, 97),
         R_avg_BODY_landed = map_chr(shuffled_data, 98),
         R_avg_opp_BODY_att = map_chr(shuffled_data, 99),
         R_avg_opp_BODY_landed = map_chr(shuffled_data, 100),
         R_avg_LEG_att = map_chr(shuffled_data, 101),
         R_avg_LEG_landed = map_chr(shuffled_data, 102),
         R_avg_opp_LEG_att = map_chr(shuffled_data, 103),
         R_avg_opp_LEG_landed = map_chr(shuffled_data, 104),
         R_avg_DISTANCE_att = map_chr(shuffled_data, 105),
         R_avg_DISTANCE_landed = map_chr(shuffled_data, 106),
         R_avg_opp_DISTANCE_att = map_chr(shuffled_data, 107),
         R_avg_opp_DISTANCE_landed = map_chr(shuffled_data, 108),
         R_avg_CLINCH_att = map_chr(shuffled_data, 109),
         R_avg_CLINCH_landed = map_chr(shuffled_data, 110),
         R_avg_opp_CLINCH_att = map_chr(shuffled_data, 111),
         R_avg_opp_CLINCH_landed = map_chr(shuffled_data, 112),
         R_avg_GROUND_att = map_chr(shuffled_data, 113),
         R_avg_GROUND_landed = map_chr(shuffled_data, 114),
         R_avg_opp_GROUND_att = map_chr(shuffled_data, 115),
         R_avg_opp_GROUND_landed = map_chr(shuffled_data, 116),
         R_avg_CTRL_time.seconds. = map_chr(shuffled_data, 117),
         R_avg_opp_CTRL_time.seconds. = map_chr(shuffled_data, 118),
         R_total_time_fought.seconds. = map_chr(shuffled_data, 119),
         R_total_rounds_fought = map_chr(shuffled_data, 120),
         R_total_title_bouts = map_chr(shuffled_data, 121),
         R_current_win_streak = map_chr(shuffled_data, 122),
         R_current_lose_streak = map_chr(shuffled_data, 123),
         R_longest_win_streak = map_chr(shuffled_data, 124),
         R_wins = map_chr(shuffled_data, 125),
         R_losses = map_chr(shuffled_data, 126),
         R_draw = map_chr(shuffled_data, 127),
         R_win_by_Decision_Majority = map_chr(shuffled_data, 128),
         R_win_by_Decision_Split = map_chr(shuffled_data, 129),
         R_win_by_Decision_Unanimous = map_chr(shuffled_data, 130),
         R_win_by_KO.TKO = map_chr(shuffled_data, 131),
         R_win_by_Submission = map_chr(shuffled_data, 132),
         R_win_by_TKO_Doctor_Stoppage = map_chr(shuffled_data, 133),
         R_Stance = map_chr(shuffled_data, 134),
         R_Height_cms = map_chr(shuffled_data, 135),
         R_Reach_cms = map_chr(shuffled_data, 136),
         R_Weight_lbs = map_chr(shuffled_data, 137),
         R_age = map_chr(shuffled_data, 138))
```


```{r}
ufc_data_shuffled <- ufc_data_shuffled %>%
  mutate(Winner = ifelse(Winner2 == R_fighter, "Red", "Blue"))
```

```{r}
#turning all appropriate columns numeric
ufc_data_shuffled <- ufc_data_shuffled %>%
  mutate_at(9:71, as.numeric) %>% 
  mutate_at(73:138, as.numeric) %>% 
  mutate_at(140:144, as.numeric)
```



```{r}
#ufc_data_shuffled %>% group_by(R_Stance) %>% summarize(count = n())
#ufc_data_shuffled %>% group_by(B_Stance) %>% summarize(count = n())
```



```{r}
#distribution of winner for each side
ggplot(data = ufc_data_shuffled, aes(x = Winner, fill = Winner)) + geom_bar() + scale_fill_manual(values = c("blue", "red")) + labs(title = "New Distribution of Blue & Red Winners", subtitle = "After Randomization of Classification")

#ufc_data_shuffled %>% group_by(Winner) %>% summarise(count = n())

```

After shuffling the data, we see a much more even distribution of fight winners between the red and blue corner. Similar to comparing the difference between men's and women's MMA, we believe the fighting styles begin to differ as fighters increase in weight class. Therefore, rather than creating nine different models for each class, we will group weight classes together as seen below: 



```{r}
ufc_data_shuffled <- ufc_data_shuffled %>% mutate(weight = case_when(weight_class == "Flyweight" ~ 125,
                                   weight_class == "Bantamweight" ~ 135,
                                   weight_class == "Featherweight" ~ 145,
                                   weight_class == "Lightweight" ~ 155,
                                   weight_class == "Welterweight" ~ 170,
                                   weight_class == "Middleweight" ~ 185,
                                   weight_class == "LightHeavyweight" ~ 205, 
                                   weight_class == "Heavyweight" ~ 265, 
                                   weight_class == "OpenWeight" ~ 300))

ufc_data_shuffled <- ufc_data_shuffled %>% mutate(new_class = case_when(weight_class == "Flyweight" ~ "Class 1",
                                   weight_class == "Bantamweight" ~ "Class 1",
                                   weight_class == "Featherweight" ~ "Class 1",
                                   weight_class == "Lightweight" ~ "Class 2",
                                   weight_class == "Welterweight" ~ "Class 2",
                                   weight_class == "Middleweight" ~ "Class 3",
                                   weight_class == "LightHeavyweight" ~ "Class 3", 
                                   weight_class == "Heavyweight" ~ "Class 4", 
                                   weight_class == "OpenWeight" ~ "Class 4"))

freq <- ufc_data_shuffled %>% group_by(new_class, weight_class) %>% 
  summarize(max_weight = max(weight),
            count = n()) %>% arrange(max_weight)

kable(freq, caption = "Frequency of Weight Class Fights")




```


```{r}
new_class_freq <- ufc_data_shuffled %>% group_by(new_class) %>% summarize(freq = n())

ggplot(data=new_class_freq, aes(x=new_class, y=freq)) +
  geom_bar(stat="identity", fill="steelblue")+
  theme_minimal() + labs(x = "New Class for Model Building", y = "Count", 
                         title = "Frequency Distribution of New Weight Classes")
```

The plot above displays the new distribution of observations by the new weight classes. While we were unable to create a completely even split of observations, we believe we have enough fights within each new segmentation to proceed in fitting four models. The table below shows the average attempts of different types of strikes for one classification of the fighters. We see that numbers tend to decrease for standing strikes such as the head, body, and leg as the weight class increases. This could be because heavier fighters prefer to spend more of the fight wrestling on the floor, or heavier fights typically lasting less time, with such cases not mutually exclusive. 



```{r}
## EDA that justifies splitting model by weight class 
Ratt_class <- ufc_data_shuffled %>% group_by(new_class) %>% summarise(Rmean_head = mean(R_avg_HEAD_att, na.rm = TRUE), 
                                                        Rmean_body = mean(R_avg_BODY_att, na.rm = TRUE), 
                                                        Rmean_leg = mean(R_avg_LEG_att, na.rm = TRUE), 
                                                        Rmean_clinch = mean(R_avg_CLINCH_att, na.rm = TRUE),
                                                        Rmean_ground = mean(R_avg_GROUND_att, na.rm = TRUE),
                                                        Rmean_ctrltime = mean(R_avg_CTRL_time.seconds., na.rm = TRUE))
kable(Ratt_class, caption = "Avg Attempt of Different Style Attacks", digits = 1)


```



## Methodology

Before constructing our four models, we first want to remove variables within our dataset that are either redundant or will not provide useful information in predicting a winner. We will remove many of the multi-class variables, such as the red and blue fighter's names and the referee's name, that would significantly increase the complexity of our models. We will also remove the amount of draws a previous fighter has in their career as all rows equate to zero for both the red and blue fighters. Elastic net model creation requires that the data is clean and does not contain missing values. Although we removed many of the initial missing values for when it was a fighter's UFC debut, there are other cases in our dataset in which a fighter's age or reach is not recorded. We considered imputing the data using averages, but ultimately decided to remove these rows alltogther to avoid potential biases that may arise from imputation. We also believed our sample size was large enough to construct our models. 

```{r}
# Removing Columns that will provide no meaning to our models
ufc_data_shuffled_subsetted <-  ufc_data_shuffled[,!names(ufc_data_shuffled) %in% c("R_fighter", "B_fighter", "Referee",
                                                                                    "location", "first_fight", "Winner2",
                                                                                    "shuffled_data", "date", "fight_gender",
                                                                                    "year", "weight", "weight_class")]
```

```{r, eval = FALSE}
ufc_data_shuffled_subsetted  %>%
  group_by(R_draw) %>%
  summarise(count = n())

ufc_data_shuffled_subsetted  %>%
  group_by(B_draw) %>%
  summarise(count = n())

ufc_data_shuffled_subsetted <-  ufc_data_shuffled_subsetted[,!names(ufc_data_shuffled_subsetted) 
                                                            %in% c("R_draw", "B_draw")]
```




```{r}
# removing all rows with NA values
ufc_data_shuffled_subsetted <- na.omit(ufc_data_shuffled_subsetted)

#nrow(ufc_data_shuffled)
#nrow(ufc_data_shuffled_subsetted)
#nrow(ufc_data_shuffled) - nrow(ufc_data_shuffled_subsetted)
```



```{r}
# creating 4 different dataframes, dividing up by our weight class division
class1 <- ufc_data_shuffled_subsetted %>% filter(new_class == "Class 1")
class2 <- ufc_data_shuffled_subsetted %>% filter(new_class == "Class 2")
class3 <- ufc_data_shuffled_subsetted %>% filter(new_class == "Class 3")
class4 <- ufc_data_shuffled_subsetted %>% filter(new_class == "Class 4")

class1 <-  class1[,!names(class1) %in% c("new_class")]
class2 <-  class2[,!names(class2) %in% c("new_class")]
class3 <-  class3[,!names(class3) %in% c("new_class")]
class4 <-  class4[,!names(class4) %in% c("new_class")]


```

To create the four separate models for the weight class segmentation, we have to create four separate data frames from which we can create training and test splits. Additionally, since the structure of our data set includes the number of attempts and successes for a given strike, as well as current win streak and overall wins on a fighter's record, we suspect that many potential predictors will be extremely multicollinear. To combat this, we plan to use ridge regression to introduce bias that can lower the variance of the estimates. However, since our models contain several predictors and ridge regression does not perform variable selection, we want to use lasso regression as well to assign estimates of irrelevant predictors to zero. The combination of both methods is called elastic net regression a regression model that includes both the L1 penalty of Lasso and the L2 penalty of Ridge regression. Elastic Net combines both L2 and L1 penalties of ridge regression and lasso. It controls the mixing of the two penalties through a parameter (lambda).

```{r}
# check multicollinearity
corr_data_class1 <- class1[sapply(class1, is.numeric)]
corr_data_class1 <- corr_data_class1[, sapply(corr_data_class1, function(x) sd(x, na.rm = TRUE) > 0)]

extract_high_corr <- function(corr_data_class1, threshold = 0.7) {
  corr_matrix <- cor(corr_data_class1, use = "complete.obs")
  high_corr <- data.frame(Var1 = character(), 
                                  Var2 = character(), 
                                  Correlation = numeric())
  for (i in 1:(ncol(corr_matrix)-1)) {
    for (j in (i+1):ncol(corr_matrix)) {
      if (abs(corr_matrix[i, j]) > threshold) {
        high_corr <- rbind(high_corr, 
                           data.frame(Var1 = colnames(corr_matrix)[i],
                                      Var2 = colnames(corr_matrix)[j],
                                      Correlation = corr_matrix[i, j]))
      }
    }
  }
  return(high_corr)
}

#extract_high_corr(corr_data_class1, 0.95)
```

```{r}
corr_data_class2 <- class2[sapply(class2, is.numeric)]
corr_data_class2 <- corr_data_class2[, sapply(corr_data_class2, function(x) sd(x, na.rm = TRUE) > 0)]

extract_high_corr <- function(corr_data_class2, threshold = 0.7) {
  corr_matrix <- cor(corr_data_class2, use = "complete.obs")
  high_corr <- data.frame(Var1 = character(), 
                                  Var2 = character(), 
                                  Correlation = numeric())
  for (i in 1:(ncol(corr_matrix)-1)) {
    for (j in (i+1):ncol(corr_matrix)) {
      if (abs(corr_matrix[i, j]) > threshold) {
        high_corr <- rbind(high_corr, 
                           data.frame(Var1 = colnames(corr_matrix)[i],
                                      Var2 = colnames(corr_matrix)[j],
                                      Correlation = corr_matrix[i, j]))
      }
    }
  }
  return(high_corr)
}

#extract_high_corr(corr_data_class2, 0.8)
```

```{r}
corr_data_class3 <- class3[sapply(class3, is.numeric)]
corr_data_class3 <- corr_data_class3[, sapply(corr_data_class3, function(x) sd(x, na.rm = TRUE) > 0)]

extract_high_corr <- function(corr_data_class3, threshold = 0.7) {
  corr_matrix <- cor(corr_data_class3, use = "complete.obs")
  high_corr <- data.frame(Var1 = character(), 
                                  Var2 = character(), 
                                  Correlation = numeric())
  for (i in 1:(ncol(corr_matrix)-1)) {
    for (j in (i+1):ncol(corr_matrix)) {
      if (abs(corr_matrix[i, j]) > threshold) {
        high_corr <- rbind(high_corr, 
                           data.frame(Var1 = colnames(corr_matrix)[i],
                                      Var2 = colnames(corr_matrix)[j],
                                      Correlation = corr_matrix[i, j]))
      }
    }
  }
  return(high_corr)
}

#extract_high_corr(corr_data_class3, 0.7)
```

```{r}
corr_data_class4 <- class4[sapply(class4, is.numeric)]
corr_data_class4 <- corr_data_class4[, sapply(corr_data_class4, function(x) sd(x, na.rm = TRUE) > 0)]

extract_high_corr <- function(corr_data_class4, threshold = 0.7) {
  corr_matrix <- cor(corr_data_class4, use = "complete.obs")
  high_corr <- data.frame(Var1 = character(), 
                                  Var2 = character(), 
                                  Correlation = numeric())
  for (i in 1:(ncol(corr_matrix)-1)) {
    for (j in (i+1):ncol(corr_matrix)) {
      if (abs(corr_matrix[i, j]) > threshold) {
        high_corr <- rbind(high_corr, 
                           data.frame(Var1 = colnames(corr_matrix)[i],
                                      Var2 = colnames(corr_matrix)[j],
                                      Correlation = corr_matrix[i, j]))
      }
    }
  }
  return(high_corr)
}

#extract_high_corr(corr_data_class4, 0.7)
```

In looking at the correlation coefficients between predictors for each class, we notice that coefficients for the same type of strike exceed 0.95 (such has avg strikes attempted and landed to the opponent's head). Correlation coefficients are also extremely high for significant strike predictors and other forms of strikes, such as head, body, and leg. Therefore, once we fit each of the models, we will also construct likelihood ratio tests to determine if the inclusion of interactions amongst the selected variables help improve the model. 



```{r}
set.seed(12)
class1$id <- 1:nrow(class1)
class1_train <- class1 %>% dplyr::sample_frac(0.7)
class1_test  <- dplyr::anti_join(class1, class1_train, by = 'id')

class2$id <- 1:nrow(class2)
class2_train <- class2 %>% dplyr::sample_frac(0.7)
class2_test  <- dplyr::anti_join(class2, class2_train, by = 'id')

class3$id <- 1:nrow(class3)
class3_train <- class3 %>% dplyr::sample_frac(0.7)
class3_test  <- dplyr::anti_join(class3, class3_train, by = 'id')

class4$id <- 1:nrow(class4)
class4_train <- class4 %>% dplyr::sample_frac(0.7)
class4_test  <- dplyr::anti_join(class4, class4_train, by = 'id')
```





```{r}
# scaling numerical predictors
#names(class1)[sapply(class1, is.numeric)]

numerical_columns <- c("B_avg_KD", "B_avg_opp_KD", "B_avg_SIG_STR_pct",
                       "B_avg_opp_SIG_STR_pct", "B_avg_TD_pct", "B_avg_opp_TD_pct", "B_avg_SUB_ATT",
                       "B_avg_opp_SUB_ATT", "B_avg_REV", "B_avg_opp_REV", 
                       "B_avg_SIG_STR_att", "B_avg_SIG_STR_landed",
                       "B_avg_opp_SIG_STR_att", "B_avg_opp_SIG_STR_landed", 
                       "B_avg_TOTAL_STR_att", "B_avg_TOTAL_STR_landed",
                       "B_avg_opp_TOTAL_STR_att", "B_avg_opp_TOTAL_STR_landed", 
                       "B_avg_TD_att", "B_avg_TD_landed", "B_avg_opp_TD_att", 
                       "B_avg_opp_TD_landed", "B_avg_HEAD_att",
                       "B_avg_HEAD_landed", "B_avg_opp_HEAD_att", 
                       "B_avg_opp_HEAD_landed", "B_avg_BODY_att",
                       "B_avg_BODY_landed", "B_avg_opp_BODY_att", 
                       "B_avg_opp_BODY_landed", "B_avg_LEG_att", 
                       "B_avg_LEG_landed", "B_avg_opp_LEG_att", 
                       "B_avg_opp_LEG_landed", "B_avg_DISTANCE_att",
                       "B_avg_DISTANCE_landed", "B_avg_opp_DISTANCE_att", 
                       "B_avg_opp_DISTANCE_landed", "B_avg_CLINCH_att", 
                       "B_avg_CLINCH_landed", "B_avg_opp_CLINCH_att",
                       "B_avg_opp_CLINCH_landed", "B_avg_GROUND_att", "B_avg_GROUND_landed",
                       "B_avg_opp_GROUND_att", "B_avg_opp_GROUND_landed", "B_avg_CTRL_time.seconds.",
                       "B_avg_opp_CTRL_time.seconds.", "B_total_time_fought.seconds.",
                       "B_total_rounds_fought", "B_total_title_bouts", "B_current_win_streak",
                       "B_current_lose_streak", "B_longest_win_streak", "B_wins", "B_losses",
                       "B_win_by_Decision_Majority", "B_win_by_Decision_Split",
                       "B_win_by_Decision_Unanimous", "B_win_by_KO.TKO", "B_win_by_Submission",
                       "B_win_by_TKO_Doctor_Stoppage", "B_Height_cms", "B_Reach_cms",
                       "B_Weight_lbs", "B_age", "R_avg_KD", "R_avg_opp_KD", "R_avg_SIG_STR_pct", 
                       "R_avg_opp_SIG_STR_pct", "R_avg_TD_pct", "R_avg_opp_TD_pct", "R_avg_SUB_ATT", 
                       "R_avg_opp_SUB_ATT", "R_avg_REV", "R_avg_opp_REV", "R_avg_SIG_STR_att", 
                       "R_avg_SIG_STR_landed", "R_avg_opp_SIG_STR_att",
                       "R_avg_opp_SIG_STR_landed", "R_avg_TOTAL_STR_att", "R_avg_TOTAL_STR_landed",
                       "R_avg_opp_TOTAL_STR_att", "R_avg_opp_TOTAL_STR_landed", "R_avg_TD_att",
                       "R_avg_TD_landed", "R_avg_opp_TD_att", "R_avg_opp_TD_landed", "R_avg_HEAD_att",
                       "R_avg_HEAD_landed", "R_avg_opp_HEAD_att", "R_avg_opp_HEAD_landed", "R_avg_BODY_att",
                       "R_avg_BODY_landed", "R_avg_opp_BODY_att", "R_avg_opp_BODY_landed", "R_avg_LEG_att",
                       "R_avg_LEG_landed", "R_avg_opp_LEG_att", "R_avg_opp_LEG_landed", "R_avg_DISTANCE_att",
                       "R_avg_DISTANCE_landed", "R_avg_opp_DISTANCE_att", "R_avg_opp_DISTANCE_landed",
                       "R_avg_CLINCH_att", "R_avg_CLINCH_landed", "R_avg_opp_CLINCH_att",
                       "R_avg_opp_CLINCH_landed", "R_avg_GROUND_att", "R_avg_GROUND_landed",
                       "R_avg_opp_GROUND_att", "R_avg_opp_GROUND_landed", "R_avg_CTRL_time.seconds.",
                       "R_avg_opp_CTRL_time.seconds.", "R_total_time_fought.seconds.",
                       "R_total_rounds_fought", "R_total_title_bouts", "R_current_win_streak",
                       "R_current_lose_streak", "R_longest_win_streak", "R_wins", "R_losses",
                       "R_win_by_Decision_Majority", "R_win_by_Decision_Split",
                       "R_win_by_Decision_Unanimous", "R_win_by_KO.TKO", "R_win_by_Submission",
                       "R_win_by_TKO_Doctor_Stoppage", "R_Height_cms", "R_Reach_cms", "R_Weight_lbs", "R_age")


# Calculate mean and standard deviation on the training data
class1train_means <- colMeans(class1_train[, numerical_columns])
class1train_sds <- apply(class1_train[, numerical_columns], 2, sd)

class1train_scaled <- class1_train
class1train_scaled[, numerical_columns] <- scale(class1train_scaled[, numerical_columns], center = class1train_means, scale = class1train_sds)

class1test_scaled <- class1_test
class1test_scaled[, numerical_columns] <- scale(class1test_scaled[, numerical_columns], center = class1train_means, scale = class1train_sds)




class2train_means <- colMeans(class2_train[, numerical_columns])
class2train_sds <- apply(class2_train[, numerical_columns], 2, sd)

class2train_scaled <- class2_train
class2train_scaled[, numerical_columns] <- scale(class2train_scaled[, numerical_columns], center = class2train_means, scale = class2train_sds)

class2test_scaled <- class2_test
class2test_scaled[, numerical_columns] <- scale(class2test_scaled[, numerical_columns], center = class2train_means, scale = class2train_sds)




class3train_means <- colMeans(class3_train[, numerical_columns])
class3train_sds <- apply(class3_train[, numerical_columns], 2, sd)

class3train_scaled <- class3_train
class3train_scaled[, numerical_columns] <- scale(class3train_scaled[, numerical_columns], center = class3train_means, scale = class3train_sds)

class3test_scaled <- class3_test
class3test_scaled[, numerical_columns] <- scale(class3test_scaled[, numerical_columns], center = class3train_means, scale = class3train_sds)




class4train_means <- colMeans(class4_train[, numerical_columns])
class4train_sds <- apply(class4_train[, numerical_columns], 2, sd)

class4train_scaled <- class4_train
class4train_scaled[, numerical_columns] <- scale(class4train_scaled[, numerical_columns], center = class4train_means, scale = class4train_sds)

class4test_scaled <- class4_test
class4test_scaled[, numerical_columns] <- scale(class4test_scaled[, numerical_columns], center = class4train_means, scale = class4train_sds)
```

```{r}
# transform categorical predictors
library(caret)

dummies1train <- dummyVars(~ Winner + title_bout + B_Stance + R_Stance, data = class1train_scaled)
dummy_data1 <- predict(dummies1train, newdata = class1train_scaled)
class1train_scaled <- cbind(class1train_scaled[, !names(class1train_scaled) %in% c('Winner', 
                                                                    'title_bout', 'B_Stance', 'R_Stance')], dummy_data1)
class1train_scaled <-  class1train_scaled[,!names(class1train_scaled) %in% c("WinnerBlue")]

dummies1test <- dummyVars(~ Winner + title_bout + B_Stance + R_Stance, data = class1test_scaled)
dummy_data1 <- predict(dummies1test, newdata = class1test_scaled)
class1test_scaled <- cbind(class1test_scaled[, !names(class1test_scaled) %in% c('Winner', 
                                                                    'title_bout', 'B_Stance', 'R_Stance')], dummy_data1)
class1test_scaled <-  class1test_scaled[,!names(class1test_scaled) %in% c("WinnerBlue")]



dummies2train <- dummyVars(~ Winner + title_bout + B_Stance + R_Stance, data = class2train_scaled)
dummy_data2 <- predict(dummies2train, newdata = class2train_scaled)
class2train_scaled <- cbind(class2train_scaled[, !names(class2train_scaled) %in% c('Winner', 
                                                                    'title_bout', 'B_Stance', 'R_Stance')], dummy_data2)
class2train_scaled <-  class2train_scaled[,!names(class2train_scaled) %in% c("WinnerBlue")]

dummies2test <- dummyVars(~ Winner + title_bout + B_Stance + R_Stance, data = class2test_scaled)
dummy_data2 <- predict(dummies2test, newdata = class2test_scaled)
class2test_scaled <- cbind(class2test_scaled[, !names(class2test_scaled) %in% c('Winner', 
                                                                    'title_bout', 'B_Stance', 'R_Stance')], dummy_data2)
class2test_scaled <-  class2test_scaled[,!names(class2test_scaled) %in% c("WinnerBlue")]



dummies3train <- dummyVars(~ Winner + title_bout + B_Stance + R_Stance, data = class3train_scaled)
dummy_data3 <- predict(dummies3train, newdata = class3train_scaled)
class3train_scaled <- cbind(class3train_scaled[, !names(class3train_scaled) %in% c('Winner', 
                                                                    'title_bout', 'B_Stance', 'R_Stance')], dummy_data3)
class3train_scaled <-  class3train_scaled[,!names(class3train_scaled) %in% c("WinnerBlue")]

dummies3test <- dummyVars(~ Winner + title_bout + B_Stance + R_Stance, data = class3test_scaled)
dummy_data3 <- predict(dummies3test, newdata = class3test_scaled)
class3test_scaled <- cbind(class3test_scaled[, !names(class3test_scaled) %in% c('Winner', 
                                                                    'title_bout', 'B_Stance', 'R_Stance')], dummy_data3)
class3test_scaled <-  class3test_scaled[,!names(class3test_scaled) %in% c("WinnerBlue")]



dummies4train <- dummyVars(~ Winner + title_bout + B_Stance + R_Stance, data = class4train_scaled)
dummy_data4 <- predict(dummies4train, newdata = class4train_scaled)
class4train_scaled <- cbind(class4train_scaled[, !names(class4train_scaled) %in% c('Winner', 
                                                                    'title_bout', 'B_Stance', 'R_Stance')], dummy_data4)
class4train_scaled <-  class4train_scaled[,!names(class4train_scaled) %in% c("WinnerBlue")]

dummies4test <- dummyVars(~ Winner + title_bout + B_Stance + R_Stance, data = class4test_scaled)
dummy_data4 <- predict(dummies4test, newdata = class4test_scaled)
class4test_scaled <- cbind(class4test_scaled[, !names(class4test_scaled) %in% c('Winner', 
                                                                    'title_bout', 'B_Stance', 'R_Stance')], dummy_data4)
class4test_scaled <-  class4test_scaled[,!names(class4test_scaled) %in% c("WinnerBlue")]
```

Since we plan to use elastic net that contain, we standardized the numerical predictors in our data. In doing so, we first created our training and test splits. From there, we scaled each split using the mean and standard deviation of the training data so there would not be any information leakage into our test set as we need to consider it as establishing new data. Elastic net also does not allow for multi-class categorical variables, so we need to transform the categorical variables (including our response variable) into numerical format so they can be used. We can  do this by using dummy variables. We will not include a dummy variable indicating a Winner for the blue corner so our models are only in the context of Red winning or losing (1 = Red win, 0 = Red lose). Using a 70/30 training and test split, we can use cross validation for each alpha value to find the optimal lambda. Alpha is the mixing parameter between lasso (alpha = 1) and ridge (alpha = 0) regression. We will find the combination that gives the best performance (e.g., the lowest deviance), fit the elastic net model using the optimal alpha and lambda values, and finally evaluate the model on test set to check its performance.

Accuracy: proportion of the total number of predictions that were correct.
Precision: ratio of correctly predicted positive observations to the total predicted positives.
Recall (Sensitivity): ratio of correctly predicted positive observations to all observations in the actual class. 
F1-Score: weighted average of Precision and Recall.



```{r}
# create test and train datasets
train_x1 <- as.matrix(class1train_scaled[, !names(class1train_scaled) %in% 'WinnerRed'])
train_y1 <- class1train_scaled$WinnerRed
test_x1 <- as.matrix(class1test_scaled[, !names(class1test_scaled) %in% 'WinnerRed'])
test_y1 <- class1test_scaled$WinnerRed

train_x2 <- as.matrix(class2train_scaled[, !names(class2train_scaled) %in% 'WinnerRed'])
train_y2 <- class2train_scaled$WinnerRed
test_x2 <- as.matrix(class2test_scaled[, !names(class2test_scaled) %in% 'WinnerRed'])
test_y2 <- class2test_scaled$WinnerRed

train_x3 <- as.matrix(class3train_scaled[, !names(class3train_scaled) %in% 'WinnerRed'])
train_y3 <- class3train_scaled$WinnerRed
test_x3 <- as.matrix(class3test_scaled[, !names(class3test_scaled) %in% 'WinnerRed'])
test_y3 <- class3test_scaled$WinnerRed

train_x4 <- as.matrix(class4train_scaled[, !names(class4train_scaled) %in% 'WinnerRed'])
train_y4 <- class4train_scaled$WinnerRed
test_x4 <- as.matrix(class4test_scaled[, !names(class4test_scaled) %in% 'WinnerRed'])
test_y4 <- class4test_scaled$WinnerRed
```




#### Class 1 Model

```{r}
set.seed(12)

alpha_values <- seq(.3, .9, by = 0.05)
cv_results1 <- lapply(alpha_values, function(alpha) {
  cv.glmnet(train_x1, train_y1, alpha = alpha, family = "binomial", type.measure = "deviance")
})

best_cv1 <- sapply(cv_results1, function(cv) min(cv$cvm))
best_alpha_index1 <- which.min(best_cv1)
best_alpha1 <- alpha_values[best_alpha_index1]
best_lambda1 <- cv_results1[[best_alpha_index1]]$lambda.min

final_model1 <- glmnet(train_x1, train_y1, alpha = best_alpha1, lambda = best_lambda1, family = "binomial")

final_model1_base <- glm(WinnerRed ~ B_avg_KD + B_avg_opp_SIG_STR_pct + B_avg_TD_att + B_avg_opp_TD_att + B_avg_opp_HEAD_landed + B_avg_CLINCH_att + B_win_by_Decision_Majority + B_win_by_Decision_Unanimous + B_win_by_Submission + R_avg_KD + R_avg_opp_SIG_STR_pct + R_avg_opp_TD_pct + R_avg_opp_SUB_ATT + R_avg_REV + R_avg_SIG_STR_landed + R_avg_BODY_landed + R_avg_LEG_att + R_avg_opp_CLINCH_att + R_win_by_KO.TKO + R_current_win_streak + B_age + R_age + B_StanceSwitch, family = "binomial", data = class1train_scaled)

final_model1_interactions <- glm(WinnerRed ~ B_avg_KD + B_avg_opp_SIG_STR_pct + B_avg_TD_att + B_avg_opp_TD_att + B_avg_opp_HEAD_landed + B_avg_CLINCH_att + B_win_by_Decision_Majority + B_win_by_Decision_Unanimous + B_win_by_Submission + R_avg_KD + R_avg_opp_SIG_STR_pct + R_avg_opp_TD_pct + R_avg_opp_SUB_ATT + R_avg_REV + R_avg_SIG_STR_landed + R_avg_BODY_landed + R_avg_LEG_att + R_avg_opp_CLINCH_att + R_current_win_streak + R_win_by_KO.TKO + B_age + R_age + B_StanceSwitch + R_avg_REV*R_avg_SIG_STR_landed + R_avg_BODY_landed*R_avg_SIG_STR_landed + R_avg_opp_TD_pct*R_avg_opp_SIG_STR_pct, family = "binomial", data = class1train_scaled)


#anova(final_model1_base, final_model1_interactions, test = "LRT")

#summary(final_model1_base)
# R Reversals and sig strikes landed
# R body and sig strikes landed
# R opp Takedown and R opp Sig Strikes
#Avg Sig Strikes landed ^ 2 
```


For class 1 our optimal alpha value is 0.55, which results in the variable selection of 23 predictors. Given the high coefficient values we found earlier in our methodology, we attempted to include three interaction terms. In a new model with the selected variables, we added the interaction of the average amount of reversal strikes landed for the red fighter and the average amount of significant strikes landed by the red fighter, the interaction of the average amount of body strikes landed and the average amount of significant strikes landed by the Red Fighter, and the average amount of takedowns and the average amount of significant strikes previous opponents have landed on the Red fighter. Additionally, we also included a quadratic effect for the average amount of significant strikes landed under the assumption that as a fighter delivers more damage to their opponent the probability of winning would increase exponentially. However, we failed to reject the null hypothesis in favor for the base model when each if the added terms were included and the likelihood ratio test was run. Given our elastic net model for class 1 recieved a 0.55 alpha value, we hypothesized that some of our predictors would still be multicollinear since less of a ridge penalty was used. However, in running a VIF test on our chosen predictors we did not spot any that would signify high correlation with each other which would justify either removing the predictor or testing further interactions. 



```{r}
bestsub_final_model1_base <- regsubsets(WinnerRed ~ B_avg_KD + B_avg_opp_SIG_STR_pct + B_avg_TD_att + B_avg_opp_TD_att + B_avg_opp_HEAD_landed + B_avg_CLINCH_att + B_win_by_Decision_Majority + B_win_by_Decision_Unanimous + B_win_by_Submission + R_avg_KD + R_avg_opp_SIG_STR_pct + R_avg_opp_TD_pct + R_avg_opp_SUB_ATT + R_avg_REV + R_avg_SIG_STR_landed + R_avg_BODY_landed + R_avg_LEG_att + R_avg_opp_CLINCH_att + R_win_by_KO.TKO + R_current_win_streak + B_age + B_age + B_StanceSwitch, data = class1train_scaled, nvmax = 23)
#which.min(summary(bestsub_final_model1_base)$bic)
#coef(bestsub_final_model1_base, 5)

model_1_best_subset <- glm(WinnerRed ~ B_win_by_Decision_Unanimous + R_avg_opp_SIG_STR_pct + R_avg_SIG_STR_landed + R_current_win_streak + B_age, data = class1train_scaled, family = "binomial")
```



```{r}
final_model1_simplified <- glm(WinnerRed ~ B_avg_opp_SIG_STR_pct + B_win_by_Decision_Unanimous + R_avg_opp_SIG_STR_pct + R_avg_BODY_landed + R_avg_opp_CLINCH_att + R_current_win_streak + B_age + R_age + B_StanceSwitch, data = class1train_scaled, family = "binomial")

predictions1_simple <- predict(final_model1_simplified, newdata = class1test_scaled, type = "response")
predicted_classes1_simple <- ifelse(predictions1_simple > 0.5, 1, 0)
conf_matrix1_simple <- confusionMatrix(as.factor(predicted_classes1_simple), as.factor(class1test_scaled$WinnerRed))
accuracy1_simple <- conf_matrix1_simple$overall['Accuracy']
precision1_simple <- conf_matrix1_simple$byClass['Precision']
recall1_simple <- conf_matrix1_simple$byClass['Recall']
F1_Score1_simple <- conf_matrix1_simple$byClass['F1']

Class1_stats_simple <- data.frame(Values = c(accuracy1_simple, precision1_simple, recall1_simple, F1_Score1_simple))

# Move this to results
#kable(Class1_stats_simple, digits = 3, caption = "Class 1 Model Stats Simple") %>% kable_styling(latex_options = "hold_position")

```


Since the use of interactions and the VIF did not change our model, we decided to look at the statistically significant predictors and evaluate the model's performance with just these predictors chosen. We discovered that our model performs better with less predictors, and given that our goal is to maximize predictive accuracy, we will proceeded with it as our best model. We then compared this p-value variable selection with best subset selection, both stemmed from the elastic net model. With best subset, using five of the 23 predictors minimized the BIC. However, the nine statistically significant predictors from the elastic net model, satisfying a 0.1 significance level, performed better than best subset with five predictors chosen. 

$$ log(P(Winner = Red)/1-P(Winner = Red)) = B_0 + B_1 * B\_avg\_opp\_SIG\_STR\_pct + $$
$$B_2 * B\_win\_by\_Decision\_Unanimous + B_3 * R\_avg\_opp\_SIG\_STR\_pct + B_4 * R\_avg\_BODY\_landed + $$
$$B_5 * R\_avg\_opp\_CLINCH\_att + B_6 * R\_current\_win\_streak + $$ 
$$B_7 * B\_age + B_8 * R\_age + B_9 * B\_StanceSwitch $$

In summary, for the class 1 model we used elastic net to select 23 of the existing 140 variables. We then used likelihood ratio tests to determine that none of our hypothesized interactions or inclusion of quadratic effects were significant enough to add to the model. From there, we also concluded through a vif test than none of the selected predictors contained high levels of multicollinearity that would justify the variable to be removed. Finally, we compared selecting the nine statistically significant predictors against the best subset selection and concluded that the nine statistically signficant predictors better predicted our testing data, choosing that model as our final selection. The roc curve and AUC value of 0.59 shown in the appendix signify that our model could be improved, but we will proceed to our other models to determine if the variability in UFC fight winners may place an upper bound in our model's performance. 



#### Class 2 Model

```{r}
set.seed(12)

alpha_values <- seq(.5, .9, by = 0.05)
cv_results2 <- lapply(alpha_values, function(alpha) {
  cv.glmnet(train_x2, train_y2, alpha = alpha, family = "binomial", type.measure = "deviance")
})

best_cv2 <- sapply(cv_results2, function(cv) min(cv$cvm))
best_alpha_index2 <- which.min(best_cv2)
best_alpha2 <- alpha_values[best_alpha_index2]
best_lambda2 <- cv_results2[[best_alpha_index2]]$lambda.min

final_model2 <- glmnet(train_x2, train_y2, alpha = best_alpha2, lambda = best_lambda2, family = "binomial")

final_model2_base <- glm(WinnerRed ~ B_avg_opp_SIG_STR_pct + B_avg_opp_SUB_ATT + B_avg_REV + B_avg_TD_att + B_avg_TD_landed + B_avg_CLINCH_landed + B_avg_CTRL_time.seconds. + B_total_time_fought.seconds. + B_total_title_bouts  + B_current_lose_streak + B_longest_win_streak + B_win_by_Submission + B_win_by_TKO_Doctor_Stoppage + R_avg_SIG_STR_pct + R_avg_SUB_ATT + R_avg_HEAD_landed + R_avg_opp_CLINCH_att + R_avg_GROUND_att + R_avg_opp_CTRL_time.seconds. + R_current_win_streak + R_longest_win_streak + R_win_by_Decision_Split + R_win_by_Decision_Unanimous + R_win_by_Submission + B_age + R_age + B_StanceOrthodox + B_StanceSouthpaw, data = class2train_scaled, family = "binomial")

final_model2_interactions <- glm(WinnerRed ~ B_avg_opp_SIG_STR_pct + B_avg_opp_SUB_ATT + B_avg_REV + B_avg_TD_att + B_avg_TD_landed + B_avg_CLINCH_landed + B_avg_CTRL_time.seconds. + B_total_time_fought.seconds. + B_total_title_bouts  + B_current_lose_streak + B_longest_win_streak + B_win_by_Submission + B_win_by_TKO_Doctor_Stoppage + R_avg_SIG_STR_pct + R_avg_SUB_ATT + poly(R_avg_HEAD_landed,2) + poly(R_avg_opp_CLINCH_att,2) + R_avg_GROUND_att + R_avg_opp_CTRL_time.seconds. + R_current_win_streak + R_longest_win_streak + R_win_by_Decision_Split + R_win_by_Decision_Unanimous + R_win_by_Submission + B_age + R_age + B_StanceOrthodox + B_StanceSouthpaw, data = class2train_scaled, family = "binomial")



#anova(final_model2_base, final_model2_interactions, test = "LRT")


# B Avg Takedown attempts and B Avg Takedown landed
# R avg sub attempts and r avg ground attempts
# r avg head landed and r avg sig strike pct 
# Enhanced R_avg_Head_landed and R_avg_opp_CLINCH_att to the 2nd power and it was significant!!!!
```

For class 2, we calculated an optimal alpha value of 0.65 which resulted in the variable selection of 29 predictors. We then used likelihood ratio tests to explore the inclusion of interactions and quadratic effects and discovered that including the quadratic effect for R_avg_HEAD_landed and R_avg_opp_CLINCH_att would be significant (at an alpha = 0.05 level) for our model. We then looked at the VIF values of our model and determined that none needed to be removed due to the potential presence of significant multicollinearity. Similar to class 1, we chose the 14 predictors that were statistically significant within the elastic net model to test if such reduction would improve the model's predictive accuracy. Unlike the class 1 model, such reduction decreased our model's predictive accuracy. Finally, we used best subset on the elastic net model in which the BIC value was minimized with 8 predictors. However, the full elastic net model still had the best predictive accuracy, so we will proceed with it as our final model.


```{r}
predictions2_int <- predict(final_model2_interactions, newdata = class2test_scaled, type = "response")
predicted_classes2_int <- ifelse(predictions2_int > 0.5, 1, 0)
conf_matrix2_int <- confusionMatrix(as.factor(predicted_classes2_int), as.factor(test_y2))
accuracy2_int <- conf_matrix2_int$overall['Accuracy']
precision2_int <- conf_matrix2_int$byClass['Precision']
recall2_int <- conf_matrix2_int$byClass['Recall']
F1_Score2_int <- conf_matrix2_int$byClass['F1']

Class2_int_stats <- data.frame(Values = c(accuracy2_int, precision2_int, recall2_int, F1_Score2_int))
# Move this to results
#kable(Class2_stats, digits = 3, caption = "Class 2 Elastic Net Model Stats") %>% kable_styling(latex_options = "hold_position")
```



```{r}
final_model2_interactions <- glm(WinnerRed ~ B_avg_opp_SIG_STR_pct + B_avg_opp_SUB_ATT + B_avg_REV + B_avg_TD_att + B_avg_TD_landed + B_avg_CLINCH_landed + B_avg_CTRL_time.seconds. + B_total_time_fought.seconds. + B_total_title_bouts  + B_current_lose_streak + B_longest_win_streak + B_win_by_Submission + B_win_by_TKO_Doctor_Stoppage + R_avg_SIG_STR_pct + R_avg_SUB_ATT + poly(R_avg_HEAD_landed,2) + poly(R_avg_opp_CLINCH_att,2) + R_avg_GROUND_att + R_avg_opp_CTRL_time.seconds. + R_current_win_streak + R_longest_win_streak + R_win_by_Decision_Split + R_win_by_Decision_Unanimous + R_win_by_Submission + B_age + R_age + B_StanceOrthodox + B_StanceSouthpaw, data = class2train_scaled, family = "binomial")
```


$$ log(P(Winner = Red)/1-P(Winner = Red)) = B_0 + B_1 * B\_avg\_opp\_SIG\_STR\_pct + $$
$$ B_2 * B\_avg\_opp\_SUB\_ATT + B_3 * B\_avg\_REV + B_4 * B\_avg\_TD\_att + B_5 * B\_avg\_TD\_landed + $$
$$ B_6 * B\_avg\_CLINCH\_landed +  B_7 * B\_avg\_CTRL\_time.seconds. + B_8 * B\_total\_time\_fought.seconds. + $$
$$ B_9 * B\_total\_title\_bouts + B_{10} * B\_current\_lose\_streak + B_{11} * B\_longest\_win\_streak +$$
$$ B_{12} * B\_win\_by\_Submission + B_{13} * B\_win\_by\_TKO\_Doctor\_Stoppage + B_{14} * R\_avg\_SIG\_STR\_pct + $$
$$ B_{15} * R\_avg\_SUB\_ATT + B_{16} * R\_avg\_SUB\_ATT + B_{17} * R\_avg\_HEAD\_landed + B_{18} * R\_avg\_HEAD\_landed^2 + $$
$$B_{19} * R\_avg\_opp\_CLINCH\_att + B_{20} * R\_avg\_opp\_CLINCH\_att^2 + B_{21} * R\_avg\_GROUND\_att + $$
$$B_{22} * R\_avg\_opp\_CTRL\_time.seconds. + B_{23} * R\_current\_win\_streak + B_{24} * R\_longest\_win\_streak $$
$$B_{25} * R\_win\_by\_Decision\_Split + B_{26} * R\_win\_by\_Decision\_Unanimous + B_{27} * R\_win\_by\_Submission$$
$$ B_{28} * B\_age + B_{29} * R\_age + B_{30} * B\_StanceOrthodox + B_{31} * B\_StanceSouthpaw$$

The model above results in a 0.64 AUC value, which shows improvement compared to class 1, yet has room for improvement. We will continue to monitor how the AUC values change based on the class used to construct the model. 




#### Class 3 Model 

```{r}
set.seed(12)

alpha_values <- seq(.5, .9, by = 0.05)
cv_results3 <- lapply(alpha_values, function(alpha) {
  cv.glmnet(train_x3, train_y3, alpha = alpha, family = "binomial", type.measure = "deviance")
})

best_cv3 <- sapply(cv_results3, function(cv) min(cv$cvm))
best_alpha_index3 <- which.min(best_cv3)
best_alpha3 <- alpha_values[best_alpha_index3]
best_lambda3 <- cv_results3[[best_alpha_index3]]$lambda.min

final_model3 <- glmnet(train_x3, train_y3, alpha = best_alpha3, lambda = best_lambda3, family = "binomial")

predictions3 <- predict(final_model3, newx = test_x3, type = "response", s = best_lambda3)
predicted_classes3 <- ifelse(predictions3 > 0.5, 1, 0)

final_model3_base <- glm(WinnerRed ~ B_avg_opp_SIG_STR_pct + B_avg_opp_TD_pct + B_avg_REV + B_avg_opp_REV + B_avg_SIG_STR_landed + B_avg_opp_TOTAL_STR_landed + B_avg_TD_att + B_avg_opp_TD_att + B_avg_LEG_landed + B_avg_opp_LEG_att + B_avg_opp_CLINCH_landed + B_avg_GROUND_att + B_avg_opp_GROUND_landed + B_avg_CTRL_time.seconds. + B_current_win_streak + B_current_lose_streak + B_longest_win_streak + B_win_by_Decision_Split + B_win_by_Decision_Unanimous + B_win_by_TKO_Doctor_Stoppage + B_Height_cms + B_Reach_cms + B_Weight_lbs + R_avg_KD + R_avg_SIG_STR_pct + R_avg_opp_TD_pct + R_avg_opp_SUB_ATT + R_avg_REV + R_avg_opp_TOTAL_STR_landed + R_avg_TD_landed + R_avg_opp_TD_att + R_avg_opp_HEAD_att + R_avg_BODY_landed + R_avg_opp_LEG_att + R_longest_win_streak + R_wins + R_losses + R_win_by_Decision_Split + R_win_by_KO.TKO + R_Height_cms + R_Reach_cms + R_age + B_StanceOpenStance + B_StanceOrthodox + R_StanceSouthpaw + R_StanceSwitch, data = class3train_scaled, family = "binomial")


final_model3_interactions <- glm(WinnerRed ~ B_avg_opp_SIG_STR_pct + B_avg_opp_TD_pct + B_avg_REV + B_avg_opp_REV + B_avg_SIG_STR_landed + B_avg_opp_TOTAL_STR_landed + B_avg_TD_att + B_avg_opp_TD_att + B_avg_LEG_landed + B_avg_opp_LEG_att + B_avg_opp_CLINCH_landed + B_avg_GROUND_att + B_avg_opp_GROUND_landed + B_avg_CTRL_time.seconds. + B_current_win_streak + B_current_lose_streak + B_longest_win_streak + B_win_by_Decision_Split + B_win_by_Decision_Unanimous + B_win_by_TKO_Doctor_Stoppage + B_Height_cms + B_Reach_cms + B_Weight_lbs + R_avg_KD + R_avg_SIG_STR_pct + R_avg_opp_TD_pct + R_avg_opp_SUB_ATT + R_avg_REV + R_avg_opp_TOTAL_STR_landed + R_avg_TD_landed + R_avg_opp_TD_att + R_avg_opp_HEAD_att + R_avg_BODY_landed + R_avg_opp_LEG_att + R_longest_win_streak + R_wins + R_losses + R_win_by_Decision_Split + R_win_by_KO.TKO + R_Height_cms + R_Reach_cms + R_age + B_StanceOpenStance + B_StanceOrthodox + R_StanceSouthpaw + R_StanceSwitch + B_avg_GROUND_att*B_avg_CTRL_time.seconds. + R_avg_BODY_landed*R_avg_SIG_STR_pct, data = class3train_scaled, family = "binomial")

#anova(final_model3_base, final_model3_interactions, test = "LRT")
# B open stance and B_avg_opp_SIG_STR_pct
# B_StanceOrthodox * B_avg_SIG_STR_landed
# R_Reach_cms*R_avg_SIG_STR_pct
```

Our optimal alpha value of 0.85 resulted in the variable selection of 46 predictors. Using contextual knowledge, we again considered the inclusion of various interactions and discovered that the interaction of B_avg_GROUND_att and B_avg_CTRL_time.seconds., and R_avg_BODY_landed and R_avg_SIG_STR_pct improved our model through the likelihood ratio test. With these interactions included, we then took the 22 terms with a p-value less than 0.1 and compared the model accuracy measures. The full elastic net model provided better accuracy results, so we finally compared the model against the BIC backwards selection subsetted model as best subset was not computationally possible starting with a high number of predictors. While the BIC backwards selection model resulted in only six significant predictors, the full elastic net model was still more accurate on the test data. Given our biggest priority is predictive accuracy, the full elastic model is our final selection. 




```{r}
final_model3_interactions_vif <- glm(WinnerRed ~ B_avg_opp_SIG_STR_pct + B_avg_opp_TD_pct + B_avg_REV + B_avg_opp_REV + B_avg_SIG_STR_landed + B_avg_opp_TOTAL_STR_landed + B_avg_TD_att + B_avg_opp_TD_att + B_avg_LEG_landed + B_avg_opp_LEG_att + B_avg_opp_CLINCH_landed + B_avg_GROUND_att + B_avg_opp_GROUND_landed + B_avg_CTRL_time.seconds. + B_current_win_streak + B_current_lose_streak + B_longest_win_streak + B_win_by_Decision_Split + B_win_by_Decision_Unanimous + B_win_by_TKO_Doctor_Stoppage + B_Height_cms + B_Reach_cms + B_Weight_lbs + R_avg_KD + R_avg_SIG_STR_pct + R_avg_opp_TD_pct + R_avg_opp_SUB_ATT + R_avg_REV + R_avg_opp_TOTAL_STR_landed + R_avg_TD_landed + R_avg_opp_TD_att + R_avg_opp_HEAD_att + R_avg_BODY_landed + R_avg_opp_LEG_att + R_longest_win_streak + R_losses + R_win_by_Decision_Split + R_win_by_KO.TKO + R_Height_cms + R_Reach_cms + R_age + B_StanceOpenStance + B_StanceOrthodox + R_StanceSouthpaw + R_StanceSwitch + B_avg_GROUND_att*B_avg_CTRL_time.seconds. + R_avg_BODY_landed*R_avg_SIG_STR_pct, data = class3train_scaled, family = "binomial")
```

$$log(P(Winner = Red)/1-P(Winner = Red)) = B_0 + B_1 * B\_avg\_opp\_SIG\_STR\_pct + $$
$$B_2 * B\_avg\_opp\_TD\_pct + B_3 * B\_avg\_REV + B_4 * B\_avg\_opp\_REV + B_5 * B\_avg\_SIG\_STR\_landed$$

$$B_6 * B\_avg\_opp\_TOTAL\_STR\_landed + B_7 * B\_avg\_TD\_att + B_8 * B\_avg\_opp\_TD\_att + B_9 * B\_avg\_LEG\_landed$$
$$B_{10} * B\_avg\_opp\_LEG\_att + B_{11} * B\_avg\_opp\_CLINCH\_landed + B_{12} * B\_avg\_GROUND\_att$$
$$B_{13} * B\_avg\_opp\_GROUND\_landed + B_{14} * B\_avg\_opp\_GROUND\_landed + $$
$$B_{15} * B\_avg\_CTRL\_time.seconds. + B_{16} * B\_current\_win\_streak + $$
$$B_{17} * B\_current\_lose\_streak + B_{18} * B\_longest\_win\_streak + B_{19} * B\_win\_by\_Decision\_Split +$$
$$B_{20} * B\_win\_by\_Decision\_Unanimous + B_{21} * B\_win\_by\_TKO\_Doctor\_Stoppage + $$
$$B_{22} * B\_Height\_cms + B_{23} * B\_Reach\_cms + B_{24} * B\_Weight\_lbs + B_{25} * R\_avg\_KD +$$
$$B_{26} * R\_avg\_SIG\_STR\_pct + B_{27} * R\_avg\_opp\_TD\_pct + B_{28} * R\_avg\_opp\_SUB\_ATT + $$
$$B_{29} * R\_avg\_REV + B_{30} * R\_avg\_opp\_TOTAL\_STR\_landed + B_{31} * R\_avg\_TD\_landed + $$ 
$$B_{32} * R\_avg\_opp\_TD\_att + B_{33} * R\_avg\_opp\_HEAD\_att + B_{34} * R\_avg\_BODY\_landed + $$ 
$$B_{35} * R\_avg\_opp\_LEG\_att + B_{36} * R\_longest\_win\_streak + B_{37} * R\_losses + $$ 
$$B_{38} * R\_win\_by\_Decision\_Split + B_{39} * R\_win\_by\_KO.TKO + B_{40} * R\_Height\_cms +$$
$$B_{41} * R\_Reach\_cms + B_{42} * R\_age + B_{43} * B\_StanceOpenStance  + $$ 
$$B_{44} * B\_StanceOrthodox + B_{45} * R\_StanceSouthpaw +  B_{46} * R\_StanceSwitch + $$
$$B_{47} * B\_avg\_GROUND\_att*B\_avg\_CTRL\_time.seconds. + B_{48} * R\_avg\_BODY\_landed*R\_avg\_SIG\_STR\_pct$$

The model above provides an AUC value of 0.59, which is approximately similar to classes 1 and 2. It is becoming more conclusive that we are unable to reach a significantly high value due to the variability within fight winners that is explained outside the data provided regardless of the classification threshold we set. 



```{r}
predictions3_interactions_vif <- predict(final_model3_interactions_vif, newdata = class3test_scaled, type = "response")
predicted_classes3_int_vif <- ifelse(predictions3_interactions_vif > 0.5, 1, 0)
conf_matrix3_int_vif <- confusionMatrix(as.factor(predicted_classes3_int_vif), as.factor(test_y3))
accuracy3_int_vif <- conf_matrix3_int_vif$overall['Accuracy']
precision3_int_vif <- conf_matrix3_int_vif$byClass['Precision']
recall3_int_vif <- conf_matrix3_int_vif$byClass['Recall']
F1_Score3_int_vif <- conf_matrix3_int_vif$byClass['F1']

Class3_int_vif_stats <- data.frame(Values = c(accuracy3_int_vif, precision3_int_vif, recall3_int_vif, F1_Score3_int_vif))
# Move this to results
kable(Class3_int_vif_stats, digits = 3, caption = "Class 3 Elastic Net Model Stats") %>% kable_styling(latex_options = "hold_position")
```





```{r}
model3_coef <- coef(final_model3, s = best_lambda3)
model3_coef_df <- as.data.frame(as.matrix(model3_coef))
highest_R3_win <- model3_coef_df %>% arrange(desc(s1)) %>% head(8)
lowest_R3_win <- model3_coef_df %>% arrange(s1) %>% head(8)
#kable(list(highest_R3_win, lowest_R3_win), digits = 3, caption = "Most Important Predictors for Class 3 Red Fighter") %>% kable_styling(latex_options = "hold_position")
```




### Class 4 Model

```{r, eval = FALSE}
set.seed(12)

alpha_values <- seq(.1, .9, by = 0.05)
cv_results4 <- lapply(alpha_values, function(alpha) {
  cv.glmnet(train_x4, train_y4, alpha = alpha, family = "binomial", type.measure = "deviance")
})

best_cv4 <- sapply(cv_results4, function(cv) min(cv$cvm))
best_alpha_index4 <- which.min(best_cv4)
best_alpha4 <- alpha_values[best_alpha_index4]
best_lambda4 <- cv_results4[[best_alpha_index4]]$lambda.min

final_model4 <- glmnet(train_x4, train_y4, alpha = best_alpha4, lambda = best_lambda4, family = "binomial")

predictions4 <- predict(final_model4, newx = test_x4, type = "response", s = best_lambda4)
predicted_classes4 <- ifelse(predictions4 > 0.5, 1, 0)
```

```{r, eval = FALSE}
conf_matrix4 <- confusionMatrix(as.factor(predicted_classes4), as.factor(test_y4))
accuracy4 <- conf_matrix4$overall['Accuracy']
precision4 <- conf_matrix4$byClass['Precision']
recall4 <- conf_matrix4$byClass['Recall']
F1_Score4 <- conf_matrix4$byClass['F1']
Class4_stats <- data.frame(Values = c(accuracy4, precision4, recall4, F1_Score4))
kable(Class4_stats, digits = 3, caption = "Class 4 Model Stats") %>% kable_styling(latex_options = "hold_position")
```

```{r, eval = FALSE}
model4_coef <- coef(final_model4, s = best_lambda4)
model4_coef_df <- as.data.frame(as.matrix(model4_coef))
highest_R4_win <- model4_coef_df %>% arrange(desc(s1)) %>% head(8)
lowest_R4_win <- model4_coef_df %>% arrange(s1) %>% head(8)
kable(list(highest_R4_win, lowest_R4_win), digits = 3, caption = "Most Important Predictors for Class 4 Red Fighter") %>% kable_styling(latex_options = "hold_position")
```




test explanation for class 4 models


 



## Appendix 

### Data Dictionary 
R_ and B_: Prefix signifies red and blue corner fighter stats respectively

_opp_: Containing in columns is the action done by the opponent on the fighter

fighter: Name of the fighter

Referee: Referee/On-Hand Doctor of the fight. They are responsible for ending a fight if they believe a fighter is unable to continue

date: Date of the fight 

location: Location of the fight 

Winner: The corner of the winning fighter. We will turn this into a dummy variable and will serve as our model's response variable

title_bout: True/False indicator of a championship fight for a weightclass

weight_class: Categorical variable indicating the division of the fight. There are nine male divisions and four female divisons. We will reassign the male divisons to create our models 

KD: the number of knockdowns

SIG_STR: the of significant strikes 'landed of attempted'

SIG_STR_pct: significant strikes percentage

TOTAL_STR: total strikes 'landed of attempted'

TD: number of takedowns

TD_pct: takedown percentages

SUB_ATT: number of submission attempts

REV: number of reversals landed

HEAD: number significant strikes to the head (att = attempted, landed = successful attempts)

BODY: number of significant strikes to the body (att = attempted, landed = successful attempts)

LEG: number of significant strikes to the leg (att = attempted, landed = successful attempts)

CLINCH: number of significant strikes in the clinch, also known as close quarters (att = attempted, landed = successful attempts)

GROUND: number of significant strikes on the ground (att = attempted, landed = successful attempts)

Stance: the stance of the fighter (orthodox, southpaw, etc.)

Height_cms: the height of the fighter in centimeters

Reach_cms: the reach of the fighter (arm span) in centimeters

Weight_lbs: the weight of the fighter in pounds (lbs)

age: the age of the fighter

current_lose_streak: the amount of consecutive previous fights the fighter has lost (0 if they won their previous fight) 

current_win_streak: the amount of consecutive previous fights the fighter has won (0 if they lost their previous fight) 

draw: the number of draws in the fighter's ufc career

wins: the number of wins in the fighter's ufc career

losses: the number of losses in the fighter's ufc career

total_rounds_fought: the average of total rounds fought by the fighter

total_time_fought(seconds): the count of total time spent fighting in seconds

total_title_bouts: the total number of title bouts taken part in by the fighter

win_by_Decision_Majority: the number of wins by majority judges decision in the fighter's ufc career (often 2-0 with one judge deciding a draw)

win_by_Decision_Split: the number of wins by split judges decision in the fighter's ufc career (often 2-1 in favor of one fighter)

win_by_Decision_Unanimous: the number of wins by unanimous judges decision in the fighter's ufc career

win_by_KO/TKO: the number of wins by knockout in the fighter's ufc career

win_by_Submission: the number of wins by submission in the fighter's ufc career

win_by_TKO_Doctor_Stoppage: the number of wins by doctor stoppage in the fighter's ufc career

### Model 1 Elastic Net VIF Values 

```{r}
kable(vif(final_model1_base), caption = "VIF Values for Class 1 Elastic Net Model", digits = 2) %>% kable_styling(latex_options = "hold_position")
```



### Class 1 Other Model Accuracy Measures

```{r}
predictions1 <- predict(final_model1, newx = test_x1, type = "response", lambda = best_lambda1)
predicted_classes1 <- ifelse(predictions1 > 0.5, 1, 0)
conf_matrix1 <- confusionMatrix(as.factor(predicted_classes1), as.factor(test_y1))
accuracy1 <- conf_matrix1$overall['Accuracy']
precision1 <- conf_matrix1$byClass['Precision']
recall1 <- conf_matrix1$byClass['Recall']
F1_Score1 <- conf_matrix1$byClass['F1']


Class1_stats <- data.frame(Values = c(accuracy1, precision1, recall1, F1_Score1))
kable(Class1_stats, digits = 3, caption = "Class 1 Elastic Net Model Stats") %>% kable_styling(latex_options = "hold_position")
```

```{r}
predictions1_bss <- predict(model_1_best_subset, newdata = class1test_scaled, type = "response")
predicted_classes1_bss <- ifelse(predictions1_bss > 0.5, 1, 0)
conf_matrix1_bss <- confusionMatrix(as.factor(predicted_classes1_bss), as.factor(test_y1))
length
accuracy1_bss <- conf_matrix1_bss$overall['Accuracy']
precision1_bss <- conf_matrix1_bss$byClass['Precision']
recall1_bss <- conf_matrix1_bss$byClass['Recall']
F1_Score1_bss <- conf_matrix1_bss$byClass['F1']


Class1_stats_bss <- data.frame(Values = c(accuracy1_bss, precision1_bss, recall1_bss, F1_Score1_bss))
kable(Class1_stats_bss, digits = 3, caption = "Class 1 Elastic Net --> Best Subset Model Stats") %>% kable_styling(latex_options = "hold_position")
```


### Model 1 Diagnostics
```{r model 1 diagnostics}
roc_1 <- roc(class1test_scaled$WinnerRed, predictions1_simple)
# Plot the ROC curve
plot(roc_1, main = "ROC Curve for the Class 1 
     Logistic Regression Model")
abline(0, 1, lty = 2, col = "gray")  # Add a reference line for a random classifier

# Calculate the AUC
auc_value_1 <- auc(roc_1)
cat("AUC:", auc_value_1, "\n")
```


### Model 2 VIF Values

```{r}
kable(vif(final_model2_interactions), caption = "VIF Values for Class 2 Elastic Net Model", digits = 2) %>% kable_styling(latex_options = "hold_position")
```

### Class 2 Other Model Accuracy Measures

```{r}
final_model2_simplified <- glm(WinnerRed ~ B_avg_opp_SIG_STR_pct + B_avg_REV + 
B_total_title_bouts + B_win_by_Submission + B_win_by_TKO_Doctor_Stoppage + 
  R_avg_SUB_ATT + poly(R_avg_HEAD_landed, 2) + poly(R_avg_opp_CLINCH_att, 2) + 
  R_avg_opp_CTRL_time.seconds. + R_win_by_Decision_Split + B_age + R_age, data = class2train_scaled, family = "binomial")

predictions2_simple <- predict(final_model2_simplified, newdata = class2test_scaled, type = "response")
predicted_classes2_simple <- ifelse(predictions2_simple > 0.5, 1, 0)
conf_matrix2_simple <- confusionMatrix(as.factor(predicted_classes2_simple), as.factor(class2test_scaled$WinnerRed))
accuracy2_simple <- conf_matrix2_simple$overall['Accuracy']
precision2_simple <- conf_matrix2_simple$byClass['Precision']
recall2_simple <- conf_matrix2_simple$byClass['Recall']
F1_Score2_simple <- conf_matrix2_simple$byClass['F1']

Class2_stats_simple <- data.frame(Values = c(accuracy2_simple, precision2_simple, recall2_simple, F1_Score2_simple))
kable(Class2_stats_simple, digits = 3, caption = "Class 2 Elastic Net --> P-Value Sig. Predictors Model") %>% kable_styling(latex_options = "hold_position")

```


```{r}
bestsub_final_model2_interactions <- regsubsets(WinnerRed ~ B_avg_opp_SIG_STR_pct + B_avg_opp_SUB_ATT + B_avg_REV + B_avg_TD_att + B_avg_TD_landed + B_avg_CLINCH_landed + B_avg_CTRL_time.seconds. + B_total_time_fought.seconds. + B_total_title_bouts  + B_current_lose_streak + B_longest_win_streak + B_win_by_Submission + B_win_by_TKO_Doctor_Stoppage + R_avg_SIG_STR_pct + R_avg_SUB_ATT + poly(R_avg_HEAD_landed,2) + poly(R_avg_opp_CLINCH_att,2) + R_avg_GROUND_att + R_avg_opp_CTRL_time.seconds. + R_current_win_streak + R_longest_win_streak + R_win_by_Decision_Split + R_win_by_Decision_Unanimous + R_win_by_Submission + B_age + R_age + B_StanceOrthodox + B_StanceSouthpaw, data = class2train_scaled, nvmax = 30)
#coef(bestsub_final_model2_interactions, which.min(summary(bestsub_final_model2_interactions)$bic))

model_2_best_subset <- glm(WinnerRed ~ B_avg_TD_landed + B_win_by_Submission + poly(R_avg_HEAD_landed, 2) + R_longest_win_streak + R_win_by_Decision_Split + B_age + R_age, data = class2train_scaled, family = "binomial")




predictions2_bss <- predict(model_2_best_subset, newdata = class2test_scaled, type = "response")
predicted_classes2_bss <- ifelse(predictions2_bss > 0.5, 1, 0)
conf_matrix2_bss <- confusionMatrix(as.factor(predicted_classes2_bss), as.factor(test_y2))
accuracy2_bss <- conf_matrix2_bss$overall['Accuracy']
precision2_bss <- conf_matrix2_bss$byClass['Precision']
recall2_bss <- conf_matrix2_bss$byClass['Recall']
F1_Score2_bss <- conf_matrix2_bss$byClass['F1']

Class2_stats_bss <- data.frame(Values = c(accuracy2_bss, precision2_bss, recall2_bss, F1_Score2_bss))

kable(Class2_stats_bss, digits = 3, caption = "Class 2 Elastic Net --> Best Subset Model Stats") %>% kable_styling(latex_options = "hold_position")
```



### Model 2 Diagnostics
```{r model 2 diagnostics}
roc_2 <- roc(class2test_scaled$WinnerRed, predictions2_int)
# Plot the ROC curve
plot(roc_2, main = "ROC Curve for the Class 2
     Logistic Regression Model")
abline(0, 1, lty = 2, col = "gray")  # Add a reference line for a random classifier

# Calculate the AUC
auc_value_2 <- auc(roc_2)
cat("AUC:", auc_value_2, "\n")
```




### Model 3 VIF Values
```{r}
kable(vif(final_model3_interactions), caption = "VIF Values for Class 3 Elastic Net Model", digits = 2) %>% kable_styling(latex_options = "hold_position")
```




```{r}
# Bring back up if model is large
model2_coef <- coef(final_model2, s = best_lambda2)
model2_coef_df <- as.data.frame(as.matrix(model2_coef))
highest_R2_win <- model2_coef_df %>% arrange(desc(s1)) %>% head(8)
lowest_R2_win <- model2_coef_df %>% arrange(s1) %>% head(8)
#kable(list(highest_R2_win, lowest_R2_win), digits = 3, caption = "Most Important Predictors for Class 2 Red Fighter") %>% kable_styling(latex_options = "hold_position")
```


### Class 3 Other Model Accuracy Measures

```{r}
final_model3_simplified <- glm(WinnerRed ~ B_avg_opp_TD_pct + B_avg_REV + B_avg_opp_TOTAL_STR_landed + B_avg_TD_att + B_avg_opp_TD_att + B_avg_opp_LEG_att + B_win_by_Decision_Split + B_Height_cms + B_Reach_cms + B_Weight_lbs + R_avg_KD + R_avg_TD_landed + R_avg_opp_TD_att + R_avg_opp_HEAD_att + R_age + R_StanceSwitch + B_avg_GROUND_att + B_avg_CTRL_time.seconds. + R_avg_SIG_STR_pct + R_avg_BODY_landed + B_avg_GROUND_att*B_avg_CTRL_time.seconds. + R_avg_SIG_STR_pct:R_avg_BODY_landed, data = class3train_scaled, family = "binomial")
```

```{r}
predictions3_simplified <- predict(final_model3_simplified, newdata = class3test_scaled, type = "response")
predicted_classes3_sim <- ifelse(predictions3_simplified > 0.5, 1, 0)
conf_matrix3_sim <- confusionMatrix(as.factor(predicted_classes3_sim), as.factor(test_y3))
accuracy3_sim <- conf_matrix3_sim$overall['Accuracy']
precision3_sim <- conf_matrix3_sim$byClass['Precision']
recall3_sim <- conf_matrix3_sim$byClass['Recall']
F1_Score3_sim <- conf_matrix3_sim$byClass['F1']

Class3_sim_stats <- data.frame(Values = c(accuracy3_sim, precision3_sim, recall3_sim, F1_Score3_sim))
# Move this to results
kable(Class3_sim_stats, digits = 3, caption = "Class 2 Elastic Net --> P-Val Simplified Model Stats") %>% kable_styling(latex_options = "hold_position")
```


```{r}
final_model3_backbic <- step(final_model3_interactions_vif, trace = 0, k = log(nrow(class3train_scaled)), direction = "backward")

summary(final_model3_backbic)

predictions3_backbic <- predict(final_model3_backbic, newdata = class3test_scaled, type = "response")
predicted_classes3_backbic <- ifelse(predictions3_backbic > 0.5, 1, 0)
conf_matrix3_backbic <- confusionMatrix(as.factor(predicted_classes3_backbic), as.factor(test_y3))
accuracy3_backbic <- conf_matrix3_backbic$overall['Accuracy']
precision3_backbic <- conf_matrix3_backbic$byClass['Precision']
recall3_backbic <- conf_matrix3_backbic$byClass['Recall']
F1_Score3_backbic <- conf_matrix3_backbic$byClass['F1']

Class3_stats_backbic <- data.frame(Values = c(accuracy3_backbic, precision3_backbic, recall3_backbic, F1_Score3_backbic))

kable(Class3_stats_backbic, digits = 3, caption = "Class 3 Elastic Net --> Backwards BIC Model Stats") %>% kable_styling(latex_options = "hold_position")

```

### Model 3 Diagnostics
```{r model 3 diagnostics}
roc_3 <- roc(class3test_scaled$WinnerRed, predictions3_interactions_vif)
# Plot the ROC curve
plot(roc_3, main = "ROC Curve for the Class 3
     Logistic Regression Model")
abline(0, 1, lty = 2, col = "gray")  # Add a reference line for a random classifier

# Calculate the AUC
auc_value_3 <- auc(roc_3)
cat("AUC:", auc_value_3, "\n")
```