---
title: "Predicting UFC Fight Results"
output:
  pdf_document: default
  html_document:
date: "2023-12-11"
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE, 
                      warning = FALSE)
```

```{r}
library(ggplot2)
library(readr)
library(dplyr)
library(knitr)
library(ggplot2)
library(lubridate)
library(purrr)
library(randomForest)
library(caret)
library(patchwork)
library(kableExtra)

data <- read_csv("data.csv")
```
## Introduction 

The UFC began as a professional mixed martial arts organization in 1993 serving as an alternative hand-to-hand combat sport that combined traditional boxing with wrestling, karate, kickboxing, and jiu-jistu fighting techniques. The entity was acquired by a group led by Dana White in 2001, who has served as the President for over two decades. Since estabilshing control, Dana White has exponentially grown the reach of UFC's product while also creating more structure and sanction to the sport of MMA. UFC currently has over 60 global broadcasting partners and is able to be accessed in over 165 different countries. With a traveling, tour-like model, the UFC has been able to sell-out many arenas across the world as equally become a highly-touted event to attend similar to boxing matches with well-known participants involved. 

In many other North-american based sports, organizations have invested and founded their own analytics departments. These departments are responsible for using data to acquire and develop the right talent that will lead to on-field success and improve the team's product. Since the UFC's participants are individual fighters that often follow their own training regiment, there is a smaller focus on analytics within the sport.   

The purpose of our project is two-fold. We want to evaluate fighters' historical data to determine fight styles that may posses a stronger correlation to sucess within the octagon. Identifying important factors will allow UFC fighters and their hired trainers to optimize their training regime, and will also benefit commentators in pointing out facets of the match the audience should keep in mind while spectating. 

Additionally, we want to create a model that maximizes predictive accuracy for the purposes of assisting sports bettors in finding potential opportunities for value not seen by the public. Dana White and the UFC have fully embraced the recent popularity of sports betting, forming sponsorships with companies such as bet365 in the UK, DraftKings in the US, as well as many others located worldwide. There is an established market for sports betting in the UFC, and we hope to create a model that provides an estimation of a winner between two fighters along with some form of uncertainty that allows a sports-better to determine if the predicted odds over or under-estimate a fighter's chance of winning compared to the sportsbook odds given to the public. 

Our data is each UFC fight from 1994-2021, containing each fighter's names, physical information (age, height, weight), the amount of wins and losses in their UFC history, and various fighting data. The fighting data includes the average amount of attempted and landed attacks over their UFC career, as well as the frequency of different types of attacks they have faced from their previous opponents. We plan to fit an elastic net model that incorporates the standardization of a ridge regression model, and the variable selection of a lasso regression model, to determine which predictors in our dataset are most influential. Our response variable will be the winner in each fight, with that value randomized dependent on the color of the corner assigned during the fight (red or blue). The elastic net model will be best served for UFC commentators and trainers interested in how prior fighting strategies can lead to success in the future. The estimated probability values can be compared against the moneyline odds to determine estimated value for sports bettors, and the significant coefficients can be used by trainers and coaches to adjust their fighter's strategies. 


## Data Description and EDA

The dataset used for modeling was initially sourced from ufcstats.com, where the data was processed and published on kaggle.com. The dataset contains roughly 6,012 unique fights over a 27 year span, with each row containing data on fighters in the red and blue corner, a universal classification system used throughout all rows. Since a given fighter could be in the red corner for one fight and in the blue corner for another, we don't place any value in the classification. The historical data for a given strike is split into four different columns. There is a separate column for the average amount of attempt and the average amount of strikes landed for a fighter's prior fight. Additionally, for that given strike there includes identical metrics for the averages of their prior opponents. For example, if Conor McGregor had one prior fight in which his opponent attempted 20 strikes to Conor's head and connected on 8, the row for Conor's second fight would display avg_opp_HEAD_att equal to 20 and avg_opp_HEAD_landed to 8.

In the UFC, fighters can win in a variety of different ways. If both fighters are still standing at the end of the fighter, the judges will issue a decision that is either unanimous, split, or a majority decision. The dataset includes the amount of victories by each form of decision, as well as by knockout or by the on-hand doctor stopping the fight. Our dataset also provides the current winning or losing streak for each fighter, which can be useful as it can reflect the momentum and confidence a fighter may possess. 

```{r}
#data %>% group_by(weight_class) %>% summarise(count = n())
```

```{r}
data <- data %>%
  mutate(fight_gender = ifelse(weight_class %in% c("WomenBantamweight", "WomenFeatherweight", "WomenFlyweight",
                                             "WomenStrawweight"), "women", "men"))

p1 <- ggplot(data = data, aes(x = fight_gender)) + geom_bar()
p2 <- ggplot(data = data, aes(x = Winner)) + geom_bar()

p1 + p2
```


The plots above provide a better idea on the breakdown of the amount of male and female fights in UFC's history, as well as the results based on which corner was victorious. Similar to men's and women's lacrosse or men's and women's soccer, we believe that men's and women's UFC fights should be considered different sports given the difference in fighting style. Men's MMA is centered around  wrestling, while women's MMA is centered around jiu-jitsu and judo with a strong preference for striking than grappling seen more commonly on the men's side. Since roughly 92% of the data are men's UFC fights, we will remove the observations in which the two fighters are female. The right plot above reveals that about 2/3 of fights with a winner are assigned to the red corner. Since the corners are simply a classifier and we are conerned that our models will be biased towards the red corner, we will randomize the fighters within each fight and reassign their corresponding statistics if necessary. 



```{r}
data <- data %>%
  mutate(first_fight = ifelse(is.na(B_avg_KD) | is.na(R_avg_KD), "yes", "no"))
ggplot(data = data, aes(x = first_fight)) + geom_bar() + labs(title = "Calculating Instances of a Fighter's 1st Fight")
```

Another limitation within our data is that for a fighter's first career UFC fight, they have no historical data and thus their respective columns are N/A in our dataset. Since our modeling techniques require clean data without missing data, we will need to remove instances of a fighter's first fight.



```{r, eval = FALSE}
data$date <- as.Date(data$date, format = "%m/%d/%y")

# Extract year from the Date column
data$year <- as.numeric(format(data$date, "%Y"))


year_freq <- data %>% group_by(year) %>% summarize(count = n()) 

ggplot(data = year_freq, mapping = aes(x = year, y = count)) + geom_line() + labs(x = "Year", y = "Number of Fights", title = "Trend of Number of Fights in the UFC")

```

```{r}
# Filtering for only men's fights and eliminating CatchWeight
data2 <- data %>%
  filter(fight_gender == "men" & first_fight == "no" & weight_class != "CatchWeight" & Winner != "Draw")
#nrow(data2)
```




```{r}
#randomizing blue and red
data2 <- data2 %>%
  mutate(Winner2 = ifelse(Winner == "Red", R_fighter, B_fighter)) %>%
  rename(B_avg_CTRL_time.seconds. = `B_avg_CTRL_time(seconds)`,
         B_avg_opp_CTRL_time.seconds. = `B_avg_opp_CTRL_time(seconds)`,
         B_total_time_fought.seconds. = `B_total_time_fought(seconds)`,
         B_win_by_KO.TKO = `B_win_by_KO/TKO`,
         R_avg_CTRL_time.seconds. = `R_avg_CTRL_time(seconds)`,
         R_avg_opp_CTRL_time.seconds. = `R_avg_opp_CTRL_time(seconds)`,
         R_total_time_fought.seconds. = `R_total_time_fought(seconds)`,
         R_win_by_KO.TKO = `R_win_by_KO/TKO`)
```



```{r}
set.seed(12)
shuffle_fighters <- function(B_fighter, B_avg_KD, B_avg_opp_KD, B_avg_SIG_STR_pct, B_avg_opp_SIG_STR_pct,
                             B_avg_TD_pct,B_avg_opp_TD_pct, B_avg_SUB_ATT, 
                             B_avg_opp_SUB_ATT, B_avg_REV, B_avg_opp_REV, 
                             B_avg_SIG_STR_att, B_avg_SIG_STR_landed, 
                             B_avg_opp_SIG_STR_att,B_avg_opp_SIG_STR_landed, 
                             B_avg_TOTAL_STR_att, B_avg_TOTAL_STR_landed,
                             B_avg_opp_TOTAL_STR_att, B_avg_opp_TOTAL_STR_landed, 
                             B_avg_TD_att, B_avg_TD_landed, B_avg_opp_TD_att, 
                             B_avg_opp_TD_landed, B_avg_HEAD_att,
                             B_avg_HEAD_landed, B_avg_opp_HEAD_att, 
                             B_avg_opp_HEAD_landed, B_avg_BODY_att,
                             B_avg_BODY_landed, B_avg_opp_BODY_att, 
                             B_avg_opp_BODY_landed, B_avg_LEG_att, 
                             B_avg_LEG_landed, B_avg_opp_LEG_att, 
                             B_avg_opp_LEG_landed, B_avg_DISTANCE_att,
                             B_avg_DISTANCE_landed, B_avg_opp_DISTANCE_att, 
                             B_avg_opp_DISTANCE_landed,B_avg_CLINCH_att, 
                             B_avg_CLINCH_landed, B_avg_opp_CLINCH_att, 
                             B_avg_opp_CLINCH_landed, B_avg_GROUND_att, B_avg_GROUND_landed,
                             B_avg_opp_GROUND_att, B_avg_opp_GROUND_landed, B_avg_CTRL_time.seconds.,
                             B_avg_opp_CTRL_time.seconds., B_total_time_fought.seconds., 
                             B_total_rounds_fought, B_total_title_bouts, B_current_win_streak, 
                             B_current_lose_streak, B_longest_win_streak, B_wins, B_losses, B_draw,
                             B_win_by_Decision_Majority, B_win_by_Decision_Split,
                             B_win_by_Decision_Unanimous, B_win_by_KO.TKO, B_win_by_Submission,
                             B_win_by_TKO_Doctor_Stoppage, B_Stance, B_Height_cms, B_Reach_cms, B_Weight_lbs,
                             B_age, R_fighter, R_avg_KD, R_avg_opp_KD, R_avg_SIG_STR_pct, 
                             R_avg_opp_SIG_STR_pct, R_avg_TD_pct, R_avg_opp_TD_pct, R_avg_SUB_ATT, 
                             R_avg_opp_SUB_ATT, R_avg_REV, R_avg_opp_REV, R_avg_SIG_STR_att, 
                             R_avg_SIG_STR_landed, R_avg_opp_SIG_STR_att,
                             R_avg_opp_SIG_STR_landed, R_avg_TOTAL_STR_att, R_avg_TOTAL_STR_landed,
                             R_avg_opp_TOTAL_STR_att, R_avg_opp_TOTAL_STR_landed, R_avg_TD_att,
                             R_avg_TD_landed, R_avg_opp_TD_att, R_avg_opp_TD_landed, R_avg_HEAD_att,
                             R_avg_HEAD_landed, R_avg_opp_HEAD_att, R_avg_opp_HEAD_landed, R_avg_BODY_att,
                             R_avg_BODY_landed, R_avg_opp_BODY_att, R_avg_opp_BODY_landed, R_avg_LEG_att,
                             R_avg_LEG_landed, R_avg_opp_LEG_att, R_avg_opp_LEG_landed, R_avg_DISTANCE_att,
                             R_avg_DISTANCE_landed, R_avg_opp_DISTANCE_att, R_avg_opp_DISTANCE_landed,
                             R_avg_CLINCH_att, R_avg_CLINCH_landed, R_avg_opp_CLINCH_att,
                             R_avg_opp_CLINCH_landed, R_avg_GROUND_att, R_avg_GROUND_landed,
                             R_avg_opp_GROUND_att, R_avg_opp_GROUND_landed, R_avg_CTRL_time.seconds.,
                             R_avg_opp_CTRL_time.seconds., R_total_time_fought.seconds.,
                             R_total_rounds_fought, R_total_title_bouts, R_current_win_streak,
                             R_current_lose_streak, R_longest_win_streak, R_wins, R_losses, R_draw,
                             R_win_by_Decision_Majority, R_win_by_Decision_Split,
                             R_win_by_Decision_Unanimous, R_win_by_KO.TKO, R_win_by_Submission,
                             R_win_by_TKO_Doctor_Stoppage, R_Stance, R_Height_cms, R_Reach_cms,
                             R_Weight_lbs, R_age) {
  if (runif(1) < 0.5) {
    return(c(B_fighter, B_avg_KD, B_avg_opp_KD, 
                             B_avg_SIG_STR_pct, B_avg_opp_SIG_STR_pct, 
                             B_avg_TD_pct,B_avg_opp_TD_pct, B_avg_SUB_ATT, 
                             B_avg_opp_SUB_ATT, B_avg_REV, B_avg_opp_REV, 
                             B_avg_SIG_STR_att, B_avg_SIG_STR_landed, 
                             B_avg_opp_SIG_STR_att,B_avg_opp_SIG_STR_landed, 
                             B_avg_TOTAL_STR_att, B_avg_TOTAL_STR_landed,
                             B_avg_opp_TOTAL_STR_att, B_avg_opp_TOTAL_STR_landed, 
                             B_avg_TD_att, B_avg_TD_landed, B_avg_opp_TD_att, 
                             B_avg_opp_TD_landed, B_avg_HEAD_att,
                             B_avg_HEAD_landed, B_avg_opp_HEAD_att, 
                             B_avg_opp_HEAD_landed, B_avg_BODY_att,
                             B_avg_BODY_landed, B_avg_opp_BODY_att, 
                             B_avg_opp_BODY_landed, B_avg_LEG_att, 
                             B_avg_LEG_landed, B_avg_opp_LEG_att, 
                             B_avg_opp_LEG_landed, B_avg_DISTANCE_att,
                             B_avg_DISTANCE_landed, B_avg_opp_DISTANCE_att, 
                             B_avg_opp_DISTANCE_landed,B_avg_CLINCH_att, 
                             B_avg_CLINCH_landed, B_avg_opp_CLINCH_att, 
                             B_avg_opp_CLINCH_landed, B_avg_GROUND_att, B_avg_GROUND_landed,
                             B_avg_opp_GROUND_att, B_avg_opp_GROUND_landed, B_avg_CTRL_time.seconds.,
                             B_avg_opp_CTRL_time.seconds., B_total_time_fought.seconds., 
                             B_total_rounds_fought, B_total_title_bouts, B_current_win_streak, 
                             B_current_lose_streak, B_longest_win_streak, B_wins, B_losses, B_draw,
                             B_win_by_Decision_Majority, B_win_by_Decision_Split,
                             B_win_by_Decision_Unanimous, B_win_by_KO.TKO, B_win_by_Submission,
                             B_win_by_TKO_Doctor_Stoppage, B_Stance, B_Height_cms, B_Reach_cms, B_Weight_lbs,
                             B_age, R_fighter, R_avg_KD, R_avg_opp_KD, R_avg_SIG_STR_pct, 
                             R_avg_opp_SIG_STR_pct, R_avg_TD_pct, R_avg_opp_TD_pct, R_avg_SUB_ATT, 
                             R_avg_opp_SUB_ATT, R_avg_REV, R_avg_opp_REV, R_avg_SIG_STR_att, 
                             R_avg_SIG_STR_landed, R_avg_opp_SIG_STR_att,
                             R_avg_opp_SIG_STR_landed, R_avg_TOTAL_STR_att, R_avg_TOTAL_STR_landed,
                             R_avg_opp_TOTAL_STR_att, R_avg_opp_TOTAL_STR_landed, R_avg_TD_att,
                             R_avg_TD_landed, R_avg_opp_TD_att, R_avg_opp_TD_landed, R_avg_HEAD_att,
                             R_avg_HEAD_landed, R_avg_opp_HEAD_att, R_avg_opp_HEAD_landed, R_avg_BODY_att,
                             R_avg_BODY_landed, R_avg_opp_BODY_att, R_avg_opp_BODY_landed, R_avg_LEG_att,
                             R_avg_LEG_landed, R_avg_opp_LEG_att, R_avg_opp_LEG_landed, R_avg_DISTANCE_att,
                             R_avg_DISTANCE_landed, R_avg_opp_DISTANCE_att, R_avg_opp_DISTANCE_landed,
                             R_avg_CLINCH_att, R_avg_CLINCH_landed, R_avg_opp_CLINCH_att,
                             R_avg_opp_CLINCH_landed, R_avg_GROUND_att, R_avg_GROUND_landed,
                             R_avg_opp_GROUND_att, R_avg_opp_GROUND_landed, R_avg_CTRL_time.seconds.,
                             R_avg_opp_CTRL_time.seconds., R_total_time_fought.seconds.,
                             R_total_rounds_fought, R_total_title_bouts, R_current_win_streak,
                             R_current_lose_streak, R_longest_win_streak, R_wins, R_losses, R_draw,
                             R_win_by_Decision_Majority, R_win_by_Decision_Split,
                             R_win_by_Decision_Unanimous, R_win_by_KO.TKO, R_win_by_Submission,
                             R_win_by_TKO_Doctor_Stoppage, R_Stance, R_Height_cms, R_Reach_cms,
                             R_Weight_lbs, R_age))
  } else {
    return(c(R_fighter, R_avg_KD, R_avg_opp_KD, 
                             R_avg_SIG_STR_pct, R_avg_opp_SIG_STR_pct, 
                             R_avg_TD_pct, R_avg_opp_TD_pct, R_avg_SUB_ATT, 
                             R_avg_opp_SUB_ATT, R_avg_REV, R_avg_opp_REV, 
                             R_avg_SIG_STR_att, R_avg_SIG_STR_landed, 
                             R_avg_opp_SIG_STR_att, R_avg_opp_SIG_STR_landed, 
                             R_avg_TOTAL_STR_att, R_avg_TOTAL_STR_landed,
                             R_avg_opp_TOTAL_STR_att, R_avg_opp_TOTAL_STR_landed, 
                             R_avg_TD_att, R_avg_TD_landed, R_avg_opp_TD_att, 
                             R_avg_opp_TD_landed, R_avg_HEAD_att,
                             R_avg_HEAD_landed, R_avg_opp_HEAD_att, 
                             R_avg_opp_HEAD_landed, R_avg_BODY_att,
                             R_avg_BODY_landed, R_avg_opp_BODY_att, 
                             R_avg_opp_BODY_landed, R_avg_LEG_att, 
                             R_avg_LEG_landed, R_avg_opp_LEG_att, 
                             R_avg_opp_LEG_landed, R_avg_DISTANCE_att,
                             R_avg_DISTANCE_landed, R_avg_opp_DISTANCE_att, 
                             R_avg_opp_DISTANCE_landed, R_avg_CLINCH_att, 
                             R_avg_CLINCH_landed, R_avg_opp_CLINCH_att, 
                             R_avg_opp_CLINCH_landed, R_avg_GROUND_att, R_avg_GROUND_landed,
                             R_avg_opp_GROUND_att, R_avg_opp_GROUND_landed, R_avg_CTRL_time.seconds.,
                             R_avg_opp_CTRL_time.seconds., R_total_time_fought.seconds., 
                             R_total_rounds_fought, R_total_title_bouts, R_current_win_streak, 
                             R_current_lose_streak, R_longest_win_streak, R_wins, R_losses, R_draw,
                             R_win_by_Decision_Majority, R_win_by_Decision_Split,
                             R_win_by_Decision_Unanimous, R_win_by_KO.TKO, R_win_by_Submission,
                             R_win_by_TKO_Doctor_Stoppage, R_Stance, R_Height_cms, R_Reach_cms, R_Weight_lbs,
                             R_age, B_fighter, B_avg_KD, B_avg_opp_KD, B_avg_SIG_STR_pct, 
                             B_avg_opp_SIG_STR_pct, B_avg_TD_pct, B_avg_opp_TD_pct, B_avg_SUB_ATT, 
                             B_avg_opp_SUB_ATT, B_avg_REV, B_avg_opp_REV, B_avg_SIG_STR_att, 
                             B_avg_SIG_STR_landed, B_avg_opp_SIG_STR_att,
                             B_avg_opp_SIG_STR_landed, B_avg_TOTAL_STR_att, B_avg_TOTAL_STR_landed,
                             B_avg_opp_TOTAL_STR_att, B_avg_opp_TOTAL_STR_landed, B_avg_TD_att,
                             B_avg_TD_landed, B_avg_opp_TD_att, B_avg_opp_TD_landed, B_avg_HEAD_att,
                             B_avg_HEAD_landed, B_avg_opp_HEAD_att, B_avg_opp_HEAD_landed, B_avg_BODY_att,
                             B_avg_BODY_landed, B_avg_opp_BODY_att, B_avg_opp_BODY_landed, B_avg_LEG_att,
                             B_avg_LEG_landed, B_avg_opp_LEG_att, B_avg_opp_LEG_landed, B_avg_DISTANCE_att,
                             B_avg_DISTANCE_landed, B_avg_opp_DISTANCE_att, B_avg_opp_DISTANCE_landed,
                             B_avg_CLINCH_att, B_avg_CLINCH_landed, B_avg_opp_CLINCH_att,
                             B_avg_opp_CLINCH_landed, B_avg_GROUND_att, B_avg_GROUND_landed,
                             B_avg_opp_GROUND_att, B_avg_opp_GROUND_landed, B_avg_CTRL_time.seconds.,
                             B_avg_opp_CTRL_time.seconds., B_total_time_fought.seconds.,
                             B_total_rounds_fought, B_total_title_bouts, B_current_win_streak,
                             B_current_lose_streak, B_longest_win_streak, B_wins, B_losses, B_draw,
                             B_win_by_Decision_Majority, B_win_by_Decision_Split,
                             B_win_by_Decision_Unanimous, B_win_by_KO.TKO, B_win_by_Submission,
                             B_win_by_TKO_Doctor_Stoppage, B_Stance, B_Height_cms, B_Reach_cms,
                             B_Weight_lbs, B_age))
  }
}
```


```{r}
set.seed(12)
ufc_data_shuffled <- data2 %>%
  rowwise() %>%
  mutate(shuffled_data = list(shuffle_fighters(B_fighter, B_avg_KD, B_avg_opp_KD, B_avg_SIG_STR_pct,
                                               B_avg_opp_SIG_STR_pct,B_avg_TD_pct,B_avg_opp_TD_pct, B_avg_SUB_ATT,
                                               B_avg_opp_SUB_ATT, B_avg_REV, B_avg_opp_REV, 
                                               B_avg_SIG_STR_att, B_avg_SIG_STR_landed,
                                               B_avg_opp_SIG_STR_att,B_avg_opp_SIG_STR_landed, 
                                               B_avg_TOTAL_STR_att, B_avg_TOTAL_STR_landed,
                                               B_avg_opp_TOTAL_STR_att, B_avg_opp_TOTAL_STR_landed, 
                                               B_avg_TD_att, B_avg_TD_landed, B_avg_opp_TD_att, 
                                               B_avg_opp_TD_landed, B_avg_HEAD_att,
                                               B_avg_HEAD_landed, B_avg_opp_HEAD_att, 
                                               B_avg_opp_HEAD_landed, B_avg_BODY_att,
                                               B_avg_BODY_landed, B_avg_opp_BODY_att, 
                                               B_avg_opp_BODY_landed, B_avg_LEG_att, 
                                               B_avg_LEG_landed, B_avg_opp_LEG_att, 
                                               B_avg_opp_LEG_landed, B_avg_DISTANCE_att,
                                               B_avg_DISTANCE_landed, B_avg_opp_DISTANCE_att, 
                                               B_avg_opp_DISTANCE_landed,B_avg_CLINCH_att, 
                                               B_avg_CLINCH_landed, B_avg_opp_CLINCH_att,
                                               B_avg_opp_CLINCH_landed, B_avg_GROUND_att, B_avg_GROUND_landed,
                                               B_avg_opp_GROUND_att, B_avg_opp_GROUND_landed, B_avg_CTRL_time.seconds.,
                                               B_avg_opp_CTRL_time.seconds., B_total_time_fought.seconds.,
                                               B_total_rounds_fought, B_total_title_bouts, B_current_win_streak,
                                               B_current_lose_streak, B_longest_win_streak, B_wins, B_losses, B_draw,
                                               B_win_by_Decision_Majority, B_win_by_Decision_Split,
                                               B_win_by_Decision_Unanimous, B_win_by_KO.TKO, B_win_by_Submission,
                                               B_win_by_TKO_Doctor_Stoppage, B_Stance, B_Height_cms, B_Reach_cms,
                                               B_Weight_lbs, B_age, R_fighter, R_avg_KD, R_avg_opp_KD, 
                                               R_avg_SIG_STR_pct, 
                                               R_avg_opp_SIG_STR_pct, R_avg_TD_pct, R_avg_opp_TD_pct, R_avg_SUB_ATT, 
                                               R_avg_opp_SUB_ATT, R_avg_REV, R_avg_opp_REV, R_avg_SIG_STR_att, 
                                               R_avg_SIG_STR_landed, R_avg_opp_SIG_STR_att,
                                               R_avg_opp_SIG_STR_landed, R_avg_TOTAL_STR_att, R_avg_TOTAL_STR_landed,
                                               R_avg_opp_TOTAL_STR_att, R_avg_opp_TOTAL_STR_landed, R_avg_TD_att,
                                               R_avg_TD_landed, R_avg_opp_TD_att, R_avg_opp_TD_landed, R_avg_HEAD_att,
                                               R_avg_HEAD_landed, R_avg_opp_HEAD_att, R_avg_opp_HEAD_landed,
                                               R_avg_BODY_att,
                                               R_avg_BODY_landed, R_avg_opp_BODY_att, R_avg_opp_BODY_landed,
                                               R_avg_LEG_att,
                                               R_avg_LEG_landed, R_avg_opp_LEG_att, R_avg_opp_LEG_landed,
                                               R_avg_DISTANCE_att,
                                               R_avg_DISTANCE_landed, R_avg_opp_DISTANCE_att, R_avg_opp_DISTANCE_landed,
                                               R_avg_CLINCH_att, R_avg_CLINCH_landed, R_avg_opp_CLINCH_att,
                                               R_avg_opp_CLINCH_landed, R_avg_GROUND_att, R_avg_GROUND_landed,
                                               R_avg_opp_GROUND_att, R_avg_opp_GROUND_landed, R_avg_CTRL_time.seconds.,
                                               R_avg_opp_CTRL_time.seconds., R_total_time_fought.seconds.,
                                               R_total_rounds_fought, R_total_title_bouts, R_current_win_streak,
                                               R_current_lose_streak, R_longest_win_streak, R_wins, R_losses, R_draw,
                                               R_win_by_Decision_Majority, R_win_by_Decision_Split,
                                               R_win_by_Decision_Unanimous, R_win_by_KO.TKO, R_win_by_Submission,
                                               R_win_by_TKO_Doctor_Stoppage, R_Stance, R_Height_cms, R_Reach_cms,
                                               R_Weight_lbs, R_age))) %>%
  ungroup()
```


```{r}
set.seed(12)
ufc_data_shuffled <- ufc_data_shuffled %>%
  mutate(B_fighter = map_chr(shuffled_data, 1),
         B_avg_KD = map_chr(shuffled_data, 2),
         B_avg_opp_KD = map_chr(shuffled_data, 3),
         B_avg_SIG_STR_pct = map_chr(shuffled_data, 4),
         B_avg_opp_SIG_STR_pct = map_chr(shuffled_data, 5),
         B_avg_TD_pct = map_chr(shuffled_data, 6),
         B_avg_opp_TD_pct = map_chr(shuffled_data, 7),
         B_avg_SUB_ATT = map_chr(shuffled_data, 8),
         B_avg_opp_SUB_ATT = map_chr(shuffled_data, 9),
         B_avg_REV = map_chr(shuffled_data, 10),
         B_avg_opp_REV = map_chr(shuffled_data, 11),
         B_avg_SIG_STR_att = map_chr(shuffled_data, 12),
         B_avg_SIG_STR_landed = map_chr(shuffled_data, 13),
         B_avg_opp_SIG_STR_att = map_chr(shuffled_data, 14),
         B_avg_opp_SIG_STR_landed = map_chr(shuffled_data, 15),
         B_avg_TOTAL_STR_att = map_chr(shuffled_data, 16),
         B_avg_TOTAL_STR_landed = map_chr(shuffled_data, 17),
         B_avg_opp_TOTAL_STR_att = map_chr(shuffled_data, 18),
         B_avg_opp_TOTAL_STR_landed = map_chr(shuffled_data, 19),
         B_avg_TD_att = map_chr(shuffled_data, 20),
         B_avg_TD_landed = map_chr(shuffled_data, 21),
         B_avg_opp_TD_att = map_chr(shuffled_data, 22),
         B_avg_opp_TD_landed = map_chr(shuffled_data, 23),
         B_avg_HEAD_att = map_chr(shuffled_data, 24),
         B_avg_HEAD_landed = map_chr(shuffled_data, 25),
         B_avg_opp_HEAD_att = map_chr(shuffled_data, 26),
         B_avg_opp_HEAD_landed = map_chr(shuffled_data, 27),
         B_avg_BODY_att = map_chr(shuffled_data, 28),
         B_avg_BODY_landed = map_chr(shuffled_data, 29),
         B_avg_opp_BODY_att = map_chr(shuffled_data, 30),
         B_avg_opp_BODY_landed = map_chr(shuffled_data, 31),
         B_avg_LEG_att = map_chr(shuffled_data, 32),
         B_avg_LEG_landed = map_chr(shuffled_data, 33),
         B_avg_opp_LEG_att = map_chr(shuffled_data, 34),
         B_avg_opp_LEG_landed = map_chr(shuffled_data, 35),
         B_avg_DISTANCE_att = map_chr(shuffled_data, 36),
         B_avg_DISTANCE_landed = map_chr(shuffled_data, 37),
         B_avg_opp_DISTANCE_att = map_chr(shuffled_data, 38),
         B_avg_opp_DISTANCE_landed = map_chr(shuffled_data, 39),
         B_avg_CLINCH_att = map_chr(shuffled_data, 40),
         B_avg_CLINCH_landed = map_chr(shuffled_data, 41),
         B_avg_opp_CLINCH_att = map_chr(shuffled_data, 42),
         B_avg_opp_CLINCH_landed = map_chr(shuffled_data, 43),
         B_avg_GROUND_att = map_chr(shuffled_data, 44),
         B_avg_GROUND_landed = map_chr(shuffled_data, 45),
         B_avg_opp_GROUND_att = map_chr(shuffled_data, 46),
         B_avg_opp_GROUND_landed = map_chr(shuffled_data, 47),
         B_avg_CTRL_time.seconds. = map_chr(shuffled_data, 48),
         B_avg_opp_CTRL_time.seconds. = map_chr(shuffled_data, 49),
         B_total_time_fought.seconds. = map_chr(shuffled_data, 50),
         B_total_rounds_fought = map_chr(shuffled_data, 51),
         B_total_title_bouts = map_chr(shuffled_data, 52),
         B_current_win_streak = map_chr(shuffled_data, 53),
         B_current_lose_streak = map_chr(shuffled_data, 54),
         B_longest_win_streak = map_chr(shuffled_data, 55),
         B_wins = map_chr(shuffled_data, 56),
         B_losses = map_chr(shuffled_data, 57),
         B_draw = map_chr(shuffled_data, 58),
         B_win_by_Decision_Majority = map_chr(shuffled_data, 59),
         B_win_by_Decision_Split = map_chr(shuffled_data, 60),
         B_win_by_Decision_Unanimous = map_chr(shuffled_data, 61),
         B_win_by_KO.TKO = map_chr(shuffled_data, 62),
         B_win_by_Submission = map_chr(shuffled_data, 63),
         B_win_by_TKO_Doctor_Stoppage = map_chr(shuffled_data, 64),
         B_Stance = map_chr(shuffled_data, 65),
         B_Height_cms = map_chr(shuffled_data, 66),
         B_Reach_cms = map_chr(shuffled_data, 67),
         B_Weight_lbs = map_chr(shuffled_data, 68),
         B_age = map_chr(shuffled_data, 69),
         R_fighter = map_chr(shuffled_data, 70),
         R_avg_KD = map_chr(shuffled_data, 71),
         R_avg_opp_KD = map_chr(shuffled_data, 72),
         R_avg_SIG_STR_pct = map_chr(shuffled_data, 73),
         R_avg_opp_SIG_STR_pct = map_chr(shuffled_data, 74),
         R_avg_TD_pct = map_chr(shuffled_data, 75),
         R_avg_opp_TD_pct = map_chr(shuffled_data, 76),
         R_avg_SUB_ATT = map_chr(shuffled_data, 77),
         R_avg_opp_SUB_ATT = map_chr(shuffled_data, 78),
         R_avg_REV = map_chr(shuffled_data, 79),
         R_avg_opp_REV = map_chr(shuffled_data, 80),
         R_avg_SIG_STR_att = map_chr(shuffled_data, 81),
         R_avg_SIG_STR_landed = map_chr(shuffled_data, 82),
         R_avg_opp_SIG_STR_att = map_chr(shuffled_data, 83),
         R_avg_opp_SIG_STR_landed = map_chr(shuffled_data, 84),
         R_avg_TOTAL_STR_att = map_chr(shuffled_data, 85),
         R_avg_TOTAL_STR_landed = map_chr(shuffled_data, 86),
         R_avg_opp_TOTAL_STR_att = map_chr(shuffled_data, 87),
         R_avg_opp_TOTAL_STR_landed = map_chr(shuffled_data, 88),
         R_avg_TD_att = map_chr(shuffled_data, 89),
         R_avg_TD_landed = map_chr(shuffled_data, 90),
         R_avg_opp_TD_att = map_chr(shuffled_data, 91),
         R_avg_opp_TD_landed = map_chr(shuffled_data, 92),
         R_avg_HEAD_att = map_chr(shuffled_data, 93),
         R_avg_HEAD_landed = map_chr(shuffled_data, 94),
         R_avg_opp_HEAD_att = map_chr(shuffled_data, 95),
         R_avg_opp_HEAD_landed = map_chr(shuffled_data, 96),
         R_avg_BODY_att = map_chr(shuffled_data, 97),
         R_avg_BODY_landed = map_chr(shuffled_data, 98),
         R_avg_opp_BODY_att = map_chr(shuffled_data, 99),
         R_avg_opp_BODY_landed = map_chr(shuffled_data, 100),
         R_avg_LEG_att = map_chr(shuffled_data, 101),
         R_avg_LEG_landed = map_chr(shuffled_data, 102),
         R_avg_opp_LEG_att = map_chr(shuffled_data, 103),
         R_avg_opp_LEG_landed = map_chr(shuffled_data, 104),
         R_avg_DISTANCE_att = map_chr(shuffled_data, 105),
         R_avg_DISTANCE_landed = map_chr(shuffled_data, 106),
         R_avg_opp_DISTANCE_att = map_chr(shuffled_data, 107),
         R_avg_opp_DISTANCE_landed = map_chr(shuffled_data, 108),
         R_avg_CLINCH_att = map_chr(shuffled_data, 109),
         R_avg_CLINCH_landed = map_chr(shuffled_data, 110),
         R_avg_opp_CLINCH_att = map_chr(shuffled_data, 111),
         R_avg_opp_CLINCH_landed = map_chr(shuffled_data, 112),
         R_avg_GROUND_att = map_chr(shuffled_data, 113),
         R_avg_GROUND_landed = map_chr(shuffled_data, 114),
         R_avg_opp_GROUND_att = map_chr(shuffled_data, 115),
         R_avg_opp_GROUND_landed = map_chr(shuffled_data, 116),
         R_avg_CTRL_time.seconds. = map_chr(shuffled_data, 117),
         R_avg_opp_CTRL_time.seconds. = map_chr(shuffled_data, 118),
         R_total_time_fought.seconds. = map_chr(shuffled_data, 119),
         R_total_rounds_fought = map_chr(shuffled_data, 120),
         R_total_title_bouts = map_chr(shuffled_data, 121),
         R_current_win_streak = map_chr(shuffled_data, 122),
         R_current_lose_streak = map_chr(shuffled_data, 123),
         R_longest_win_streak = map_chr(shuffled_data, 124),
         R_wins = map_chr(shuffled_data, 125),
         R_losses = map_chr(shuffled_data, 126),
         R_draw = map_chr(shuffled_data, 127),
         R_win_by_Decision_Majority = map_chr(shuffled_data, 128),
         R_win_by_Decision_Split = map_chr(shuffled_data, 129),
         R_win_by_Decision_Unanimous = map_chr(shuffled_data, 130),
         R_win_by_KO.TKO = map_chr(shuffled_data, 131),
         R_win_by_Submission = map_chr(shuffled_data, 132),
         R_win_by_TKO_Doctor_Stoppage = map_chr(shuffled_data, 133),
         R_Stance = map_chr(shuffled_data, 134),
         R_Height_cms = map_chr(shuffled_data, 135),
         R_Reach_cms = map_chr(shuffled_data, 136),
         R_Weight_lbs = map_chr(shuffled_data, 137),
         R_age = map_chr(shuffled_data, 138))
```


```{r}
ufc_data_shuffled <- ufc_data_shuffled %>%
  mutate(Winner = ifelse(Winner2 == R_fighter, "Red", "Blue"))
```

```{r}
#turning all appropriate columns numeric
ufc_data_shuffled <- ufc_data_shuffled %>%
  mutate_at(9:71, as.numeric) %>% 
  mutate_at(73:138, as.numeric) %>% 
  mutate_at(140:144, as.numeric)
```



```{r}
#distribution of winner for each side
ggplot(data = ufc_data_shuffled, aes(x = Winner, fill = Winner)) + geom_bar() + scale_fill_manual(values = c("blue", "red")) + labs(title = "New Distribution of Blue & Red Winners", subtitle = "After Randomization of Classification")

#ufc_data_shuffled %>% group_by(Winner) %>% summarise(count = n())

```

After shuffling the data, we see a much more even distribution of fight winners between the red and blue corner. Similar to comparing the difference between men's and women's MMA, we believe the fighting styles begin to differ as fighters increase in weight class. Therefore, rather than creating nine different models for each class, we will group weight classes together as seen below: 



```{r}
ufc_data_shuffled <- ufc_data_shuffled %>% mutate(weight = case_when(weight_class == "Flyweight" ~ 125,
                                   weight_class == "Bantamweight" ~ 135,
                                   weight_class == "Featherweight" ~ 145,
                                   weight_class == "Lightweight" ~ 155,
                                   weight_class == "Welterweight" ~ 170,
                                   weight_class == "Middleweight" ~ 185,
                                   weight_class == "LightHeavyweight" ~ 205, 
                                   weight_class == "Heavyweight" ~ 265, 
                                   weight_class == "OpenWeight" ~ 300))

ufc_data_shuffled <- ufc_data_shuffled %>% mutate(new_class = case_when(weight_class == "Flyweight" ~ "Class 1",
                                   weight_class == "Bantamweight" ~ "Class 1",
                                   weight_class == "Featherweight" ~ "Class 1",
                                   weight_class == "Lightweight" ~ "Class 2",
                                   weight_class == "Welterweight" ~ "Class 2",
                                   weight_class == "Middleweight" ~ "Class 3",
                                   weight_class == "LightHeavyweight" ~ "Class 3", 
                                   weight_class == "Heavyweight" ~ "Class 4", 
                                   weight_class == "OpenWeight" ~ "Class 4"))

freq <- ufc_data_shuffled %>% group_by(new_class, weight_class) %>% 
  summarize(max_weight = max(weight),
            count = n()) %>% arrange(max_weight)

kable(freq, caption = "Frequency of Weight Class Fights")




```


```{r}
new_class_freq <- ufc_data_shuffled %>% group_by(new_class) %>% summarize(freq = n())

ggplot(data=new_class_freq, aes(x=new_class, y=freq)) +
  geom_bar(stat="identity", fill="steelblue")+
  theme_minimal() + labs(x = "New Class for Model Building", y = "Count", 
                         title = "Frequency Distribution of New Weight Classes")
```

The plot above displays the new distribution of observations by the new weight classes. While we were unable to create a completely even split of observations, we believe we have enough fights within each new segmentation to proceed in fitting four models. The table below shows the average attempts of different types of strikes for one classification of the fighters. We see that numbers tend to decrease for standing strikes such as the head, body, and leg as the weight class increases. This could be because heavier fighters prefer to spend more of the fight wrestling on the floor, or heavier fights typically lasting less time, with such cases not mutually exclusive. 



```{r}
## EDA that justifies splitting model by weight class 
Ratt_class <- ufc_data_shuffled %>% group_by(new_class) %>% summarise(Rmean_head = mean(R_avg_HEAD_att, na.rm = TRUE), 
                                                        Rmean_body = mean(R_avg_BODY_att, na.rm = TRUE), 
                                                        Rmean_leg = mean(R_avg_LEG_att, na.rm = TRUE), 
                                                        Rmean_clinch = mean(R_avg_CLINCH_att, na.rm = TRUE),
                                                        Rmean_ground = mean(R_avg_GROUND_att, na.rm = TRUE),
                                                        Rmean_ctrltime = mean(R_avg_CTRL_time.seconds., na.rm = TRUE))
kable(Ratt_class, caption = "Avg Attempt of Different Style Attacks", digits = 1)


```



## Methodology

Before constructing our four models, we first want to remove variables within our dataset that are either redundant or will not provide useful information in predicting a winner. We will remove many of the multi-class variables, such as the red and blue fighter's names and the referee's name, that would significantly increase the complexity of our models. We will also remove the amount of draws a previous fighter has in their career as all rows equate to zero for both the red and blue fighters. Elastic net model creation requires that the data is clean and does not contain missing values. Although we removed many of the initial missing values for when it was a fighter's UFC debut, there are other cases in our dataset in which a fighter's age or reach is not recorded. We considered imputing the data using averages, but ultimately decided to remove these rows alltogther to avoid potential biases that may arise from imputation. We also believed our sample size was large enough to construct our models. 

```{r}
# Removing Columns that will provide no meaning to our models
ufc_data_shuffled_subsetted <-  ufc_data_shuffled[,!names(ufc_data_shuffled) %in% c("R_fighter", "B_fighter", "Referee",
                                                                                    "location", "first_fight", "Winner2",
                                                                                    "shuffled_data", "date", "fight_gender",
                                                                                    "year", "weight", "weight_class")]
```

```{r}
ufc_data_shuffled_subsetted  %>%
  group_by(R_draw) %>%
  summarise(count = n())

ufc_data_shuffled_subsetted  %>%
  group_by(B_draw) %>%
  summarise(count = n())

ufc_data_shuffled_subsetted <-  ufc_data_shuffled_subsetted[,!names(ufc_data_shuffled_subsetted) 
                                                            %in% c("R_draw", "B_draw")]
```




```{r}
# removing all rows with NA values
ufc_data_shuffled_subsetted <- na.omit(ufc_data_shuffled_subsetted)

nrow(ufc_data_shuffled)
nrow(ufc_data_shuffled_subsetted)
nrow(ufc_data_shuffled) - nrow(ufc_data_shuffled_subsetted)
```



```{r}
# creating 4 different dataframes, dividing up by our weight class division
class1 <- ufc_data_shuffled_subsetted %>% filter(new_class == "Class 1")
class2 <- ufc_data_shuffled_subsetted %>% filter(new_class == "Class 2")
class3 <- ufc_data_shuffled_subsetted %>% filter(new_class == "Class 3")
class4 <- ufc_data_shuffled_subsetted %>% filter(new_class == "Class 4")

class1 <-  class1[,!names(class1) %in% c("new_class")]
class2 <-  class2[,!names(class2) %in% c("new_class")]
class3 <-  class3[,!names(class3) %in% c("new_class")]
class4 <-  class4[,!names(class4) %in% c("new_class")]


```

To create the four separate models for the weight class segmentation, we have to create four separate data frames from which we can create training and test splits. Additionally, since the structure of our data set includes the number of attempts and successes for a given strike, as well as current win streak and overall wins on a fighter's record, we suspect that many potential predictors will be extremely multicollinear. To combat this, we plan to use ridge regression to introduce bias that can lower the variance of the estimates. However, since our models contain several predictors and ridge regression does not perform variable selection, we want to use lasso regression as well to assign estimates of irrelevant predictors to zero. The combination of both methods is called elastic net regression a regression model that includes both the L1 penalty of Lasso and the L2 penalty of Ridge regression. Elastic Net combines both L2 and L1 penalties of ridge regression and lasso. It controls the mixing of the two penalties through a parameter (lambda).

```{r}
# check multicollinearity
corr_data_class1 <- class1[sapply(class1, is.numeric)]
corr_data_class1 <- corr_data_class1[, sapply(corr_data_class1, function(x) sd(x, na.rm = TRUE) > 0)]

extract_high_corr <- function(corr_data_class1, threshold = 0.7) {
  corr_matrix <- cor(corr_data_class1, use = "complete.obs")
  high_corr <- data.frame(Var1 = character(), 
                                  Var2 = character(), 
                                  Correlation = numeric())
  for (i in 1:(ncol(corr_matrix)-1)) {
    for (j in (i+1):ncol(corr_matrix)) {
      if (abs(corr_matrix[i, j]) > threshold) {
        high_corr <- rbind(high_corr, 
                           data.frame(Var1 = colnames(corr_matrix)[i],
                                      Var2 = colnames(corr_matrix)[j],
                                      Correlation = corr_matrix[i, j]))
      }
    }
  }
  return(high_corr)
}

#extract_high_corr(corr_data_class1, 0.95)
```

```{r}
corr_data_class2 <- class2[sapply(class2, is.numeric)]
corr_data_class2 <- corr_data_class2[, sapply(corr_data_class2, function(x) sd(x, na.rm = TRUE) > 0)]

extract_high_corr <- function(corr_data_class2, threshold = 0.7) {
  corr_matrix <- cor(corr_data_class2, use = "complete.obs")
  high_corr <- data.frame(Var1 = character(), 
                                  Var2 = character(), 
                                  Correlation = numeric())
  for (i in 1:(ncol(corr_matrix)-1)) {
    for (j in (i+1):ncol(corr_matrix)) {
      if (abs(corr_matrix[i, j]) > threshold) {
        high_corr <- rbind(high_corr, 
                           data.frame(Var1 = colnames(corr_matrix)[i],
                                      Var2 = colnames(corr_matrix)[j],
                                      Correlation = corr_matrix[i, j]))
      }
    }
  }
  return(high_corr)
}

#extract_high_corr(corr_data_class2, 0.7)
```

```{r}
corr_data_class3 <- class3[sapply(class3, is.numeric)]
corr_data_class3 <- corr_data_class3[, sapply(corr_data_class3, function(x) sd(x, na.rm = TRUE) > 0)]

extract_high_corr <- function(corr_data_class3, threshold = 0.7) {
  corr_matrix <- cor(corr_data_class3, use = "complete.obs")
  high_corr <- data.frame(Var1 = character(), 
                                  Var2 = character(), 
                                  Correlation = numeric())
  for (i in 1:(ncol(corr_matrix)-1)) {
    for (j in (i+1):ncol(corr_matrix)) {
      if (abs(corr_matrix[i, j]) > threshold) {
        high_corr <- rbind(high_corr, 
                           data.frame(Var1 = colnames(corr_matrix)[i],
                                      Var2 = colnames(corr_matrix)[j],
                                      Correlation = corr_matrix[i, j]))
      }
    }
  }
  return(high_corr)
}

#extract_high_corr(corr_data_class3, 0.7)
```

```{r}
corr_data_class4 <- class4[sapply(class4, is.numeric)]
corr_data_class4 <- corr_data_class4[, sapply(corr_data_class4, function(x) sd(x, na.rm = TRUE) > 0)]

extract_high_corr <- function(corr_data_class4, threshold = 0.7) {
  corr_matrix <- cor(corr_data_class4, use = "complete.obs")
  high_corr <- data.frame(Var1 = character(), 
                                  Var2 = character(), 
                                  Correlation = numeric())
  for (i in 1:(ncol(corr_matrix)-1)) {
    for (j in (i+1):ncol(corr_matrix)) {
      if (abs(corr_matrix[i, j]) > threshold) {
        high_corr <- rbind(high_corr, 
                           data.frame(Var1 = colnames(corr_matrix)[i],
                                      Var2 = colnames(corr_matrix)[j],
                                      Correlation = corr_matrix[i, j]))
      }
    }
  }
  return(high_corr)
}

#extract_high_corr(corr_data_class4, 0.7)
```


```{r}
# scaling numerical predictors
#names(class1)[sapply(class1, is.numeric)]

numerical_columns <- c("B_avg_KD", "B_avg_opp_KD", "B_avg_SIG_STR_pct",
                       "B_avg_opp_SIG_STR_pct", "B_avg_TD_pct", "B_avg_opp_TD_pct", "B_avg_SUB_ATT",
                       "B_avg_opp_SUB_ATT", "B_avg_REV", "B_avg_opp_REV", 
                       "B_avg_SIG_STR_att", "B_avg_SIG_STR_landed",
                       "B_avg_opp_SIG_STR_att", "B_avg_opp_SIG_STR_landed", 
                       "B_avg_TOTAL_STR_att", "B_avg_TOTAL_STR_landed",
                       "B_avg_opp_TOTAL_STR_att", "B_avg_opp_TOTAL_STR_landed", 
                       "B_avg_TD_att", "B_avg_TD_landed", "B_avg_opp_TD_att", 
                       "B_avg_opp_TD_landed", "B_avg_HEAD_att",
                       "B_avg_HEAD_landed", "B_avg_opp_HEAD_att", 
                       "B_avg_opp_HEAD_landed", "B_avg_BODY_att",
                       "B_avg_BODY_landed", "B_avg_opp_BODY_att", 
                       "B_avg_opp_BODY_landed", "B_avg_LEG_att", 
                       "B_avg_LEG_landed", "B_avg_opp_LEG_att", 
                       "B_avg_opp_LEG_landed", "B_avg_DISTANCE_att",
                       "B_avg_DISTANCE_landed", "B_avg_opp_DISTANCE_att", 
                       "B_avg_opp_DISTANCE_landed", "B_avg_CLINCH_att", 
                       "B_avg_CLINCH_landed", "B_avg_opp_CLINCH_att",
                       "B_avg_opp_CLINCH_landed", "B_avg_GROUND_att", "B_avg_GROUND_landed",
                       "B_avg_opp_GROUND_att", "B_avg_opp_GROUND_landed", "B_avg_CTRL_time.seconds.",
                       "B_avg_opp_CTRL_time.seconds.", "B_total_time_fought.seconds.",
                       "B_total_rounds_fought", "B_total_title_bouts", "B_current_win_streak",
                       "B_current_lose_streak", "B_longest_win_streak", "B_wins", "B_losses",
                       "B_win_by_Decision_Majority", "B_win_by_Decision_Split",
                       "B_win_by_Decision_Unanimous", "B_win_by_KO.TKO", "B_win_by_Submission",
                       "B_win_by_TKO_Doctor_Stoppage", "B_Height_cms", "B_Reach_cms",
                       "B_Weight_lbs", "B_age", "R_avg_KD", "R_avg_opp_KD", "R_avg_SIG_STR_pct", 
                       "R_avg_opp_SIG_STR_pct", "R_avg_TD_pct", "R_avg_opp_TD_pct", "R_avg_SUB_ATT", 
                       "R_avg_opp_SUB_ATT", "R_avg_REV", "R_avg_opp_REV", "R_avg_SIG_STR_att", 
                       "R_avg_SIG_STR_landed", "R_avg_opp_SIG_STR_att",
                       "R_avg_opp_SIG_STR_landed", "R_avg_TOTAL_STR_att", "R_avg_TOTAL_STR_landed",
                       "R_avg_opp_TOTAL_STR_att", "R_avg_opp_TOTAL_STR_landed", "R_avg_TD_att",
                       "R_avg_TD_landed", "R_avg_opp_TD_att", "R_avg_opp_TD_landed", "R_avg_HEAD_att",
                       "R_avg_HEAD_landed", "R_avg_opp_HEAD_att", "R_avg_opp_HEAD_landed", "R_avg_BODY_att",
                       "R_avg_BODY_landed", "R_avg_opp_BODY_att", "R_avg_opp_BODY_landed", "R_avg_LEG_att",
                       "R_avg_LEG_landed", "R_avg_opp_LEG_att", "R_avg_opp_LEG_landed", "R_avg_DISTANCE_att",
                       "R_avg_DISTANCE_landed", "R_avg_opp_DISTANCE_att", "R_avg_opp_DISTANCE_landed",
                       "R_avg_CLINCH_att", "R_avg_CLINCH_landed", "R_avg_opp_CLINCH_att",
                       "R_avg_opp_CLINCH_landed", "R_avg_GROUND_att", "R_avg_GROUND_landed",
                       "R_avg_opp_GROUND_att", "R_avg_opp_GROUND_landed", "R_avg_CTRL_time.seconds.",
                       "R_avg_opp_CTRL_time.seconds.", "R_total_time_fought.seconds.",
                       "R_total_rounds_fought", "R_total_title_bouts", "R_current_win_streak",
                       "R_current_lose_streak", "R_longest_win_streak", "R_wins", "R_losses",
                       "R_win_by_Decision_Majority", "R_win_by_Decision_Split",
                       "R_win_by_Decision_Unanimous", "R_win_by_KO.TKO", "R_win_by_Submission",
                       "R_win_by_TKO_Doctor_Stoppage", "R_Height_cms", "R_Reach_cms", "R_Weight_lbs", "R_age")

class1_scaled <- class1
class1_scaled[, numerical_columns] <- scale(class1[, numerical_columns])

class2_scaled <- class2
class2_scaled[, numerical_columns] <- scale(class2[, numerical_columns])

class3_scaled <- class3
class3_scaled[, numerical_columns] <- scale(class3[, numerical_columns])

class4_scaled <- class4
class4_scaled[, numerical_columns] <- scale(class4[, numerical_columns])
```

```{r}
# transform categorical predictors
library(caret)

dummies1 <- dummyVars(~ Winner + title_bout + B_Stance + R_Stance, data = class1_scaled)
dummy_data1 <- predict(dummies1, newdata = class1_scaled)
class1_scaled <- cbind(class1_scaled[, !names(class1_scaled) %in% c('Winner', 
                                                                    'title_bout', 'B_Stance', 'R_Stance')], dummy_data1)
class1_scaled <-  class1_scaled[,!names(class1_scaled) %in% c("WinnerBlue")]

dummies2 <- dummyVars(~ Winner + title_bout + B_Stance + R_Stance, data = class2_scaled)
dummy_data2 <- predict(dummies2, newdata = class2_scaled)
class2_scaled <- cbind(class2_scaled[, !names(class2_scaled) %in% c('Winner',
                                                                    'title_bout', 'B_Stance', 'R_Stance')], dummy_data2)
class2_scaled <-  class2_scaled[,!names(class2_scaled) %in% c("WinnerBlue")]

dummies3 <- dummyVars(~ Winner + title_bout + B_Stance + R_Stance, data = class3_scaled)
dummy_data3 <- predict(dummies3, newdata = class3_scaled)
class3_scaled <- cbind(class3_scaled[, !names(class3_scaled) %in% c('Winner',
                                                                    'title_bout', 'B_Stance', 'R_Stance')], dummy_data3)
class3_scaled <-  class3_scaled[,!names(class3_scaled) %in% c("WinnerBlue")]

dummies4 <- dummyVars(~ Winner + title_bout + B_Stance + R_Stance, data = class4_scaled)
dummy_data4 <- predict(dummies4, newdata = class4_scaled)
class4_scaled <- cbind(class4_scaled[, !names(class4_scaled) %in% c('Winner',
                                                                    'title_bout', 'B_Stance', 'R_Stance')], dummy_data4)
class4_scaled <-  class4_scaled[,!names(class4_scaled) %in% c("WinnerBlue")]
```

Since we plan to use elastic net that contain, we standardized the numerical predictors in our data. Elastic net also does not allow for multi-class categorical variables, so we need to transform the categorical variables (including our response variable) into numerical format so they can be used in Elastic Net. We can  do this by using dummy variables. We will not include a dummy variable indicating a Winner for the blue corner so our models are only in the context of Red winning or losing (1 = Red win, 0 = Red lose). Using a 70/30 training and test split, we can use cross validation to find the optimal lambda value to penalize our predictors and use lasso to perform variable selection. 



```{r}
# create test and train datasets
set.seed(12)
class1_scaled$id <- 1:nrow(class1_scaled)
class1_train <- class1_scaled %>% dplyr::sample_frac(0.7)
class1_test  <- dplyr::anti_join(class1_scaled, class1_train, by = 'id')

class2_scaled$id <- 1:nrow(class2_scaled)
class2_train <- class2_scaled %>% dplyr::sample_frac(0.7)
class2_test  <- dplyr::anti_join(class2_scaled, class2_train, by = 'id')

class3_scaled$id <- 1:nrow(class3_scaled)
class3_train <- class3_scaled %>% dplyr::sample_frac(0.7)
class3_test  <- dplyr::anti_join(class3_scaled, class3_train, by = 'id')

class4_scaled$id <- 1:nrow(class4_scaled)
class4_train <- class4_scaled %>% dplyr::sample_frac(0.7)
class4_test  <- dplyr::anti_join(class4_scaled, class4_train, by = 'id')


train_x1 <- as.matrix(class1_train[, !names(class1_train) %in% 'WinnerRed'])
train_y1 <- class1_train$WinnerRed
test_x1 <- as.matrix(class1_test[, !names(class1_test) %in% 'WinnerRed'])
test_y1 <- class1_test$WinnerRed

train_x2 <- as.matrix(class2_train[, !names(class2_train) %in% 'WinnerRed'])
train_y2 <- class2_train$WinnerRed
test_x2 <- as.matrix(class2_test[, !names(class2_test) %in% 'WinnerRed'])
test_y2 <- class2_test$WinnerRed

train_x3 <- as.matrix(class3_train[, !names(class3_train) %in% 'WinnerRed'])
train_y3 <- class3_train$WinnerRed
test_x3 <- as.matrix(class3_test[, !names(class3_test) %in% 'WinnerRed'])
test_y3 <- class3_test$WinnerRed

train_x4 <- as.matrix(class4_train[, !names(class4_train) %in% 'WinnerRed'])
train_y4 <- class4_train$WinnerRed
test_x4 <- as.matrix(class4_test[, !names(class4_test) %in% 'WinnerRed'])
test_y4 <- class4_test$WinnerRed
```




### Class 1 Model

```{r}
library(glmnet)
set.seed(12)

alpha_values <- seq(0, 1, by = 0.1)
cv_results1 <- lapply(alpha_values, function(alpha) {
  cv.glmnet(train_x1, train_y1, alpha = alpha, family = "binomial", type.measure = "deviance")
})

best_cv1 <- sapply(cv_results1, function(cv) min(cv$cvm))
best_alpha_index1 <- which.min(best_cv1)
best_alpha1 <- alpha_values[best_alpha_index1]
best_lambda1 <- cv_results1[[best_alpha_index1]]$lambda.min

final_model1 <- glmnet(train_x1, train_y1, alpha = best_alpha1, lambda = best_lambda1, family = "binomial")

predictions1 <- predict(final_model1, newx = test_x1, type = "response", s = best_lambda1)
predicted_classes1 <- ifelse(predictions1 > 0.5, 1, 0)
```

```{r}
library(e1071)

conf_matrix1 <- confusionMatrix(as.factor(predicted_classes1), as.factor(test_y1))
accuracy1 <- conf_matrix1$overall['Accuracy']
precision1 <- conf_matrix1$byClass['Precision']
recall1 <- conf_matrix1$byClass['Recall']
F1_Score1 <- conf_matrix1$byClass['F1']

Class1_stats <- data.frame(Values = c(accuracy1, precision1, recall1, F1_Score1))
kable(Class1_stats, digits = 3, caption = "Class 1 Model Stats") %>% kable_styling(latex_options = "hold_position")
```

```{r}
model1_coef <- coef(final_model1, s = best_lambda1)
model1_coef_df <- as.data.frame(as.matrix(model1_coef))
highest_R1_win <- model1_coef_df %>% arrange(desc(s1)) %>% head(8)
lowest_R1_win <- model1_coef_df %>% arrange(s1) %>% head(8)
kable(list(highest_R1_win, lowest_R1_win), digits = 3, caption = "Most Important Predictors for Class 1 Red Fighter") %>% kable_styling(latex_options = "hold_position")
```









Now moving to models, we can perform cross-validation to find best lambda value. Will use to find the optimal lambda and alpha parameters. Alpha is the mixing parameter between Lasso (alpha = 1) and Ridge (alpha = 0) regression. Run cross-validation for each alpha value to find the optimal lambda. Find the combination that gives the best performance (e.g., the lowest deviance). Fit the Elastic Net model using the optimal alpha and lambda values. Evaluate the model on test set to check its performance.

Accuracy: proportion of the total number of predictions that were correct.
Precision: ratio of correctly predicted positive observations to the total predicted positives.
Recall (Sensitivity): ratio of correctly predicted positive observations to all observations in the actual class. 
F1-Score: weighted average of Precision and Recall.




### Class 2 Model

```{r}
set.seed(12)

alpha_values <- seq(0, 1, by = 0.1)
cv_results2 <- lapply(alpha_values, function(alpha) {
  cv.glmnet(train_x2, train_y2, alpha = alpha, family = "binomial", type.measure = "deviance")
})

best_cv2 <- sapply(cv_results2, function(cv) min(cv$cvm))
best_alpha_index2 <- which.min(best_cv2)
best_alpha2 <- alpha_values[best_alpha_index2]
best_lambda2 <- cv_results2[[best_alpha_index2]]$lambda.min

final_model2 <- glmnet(train_x2, train_y2, alpha = best_alpha2, lambda = best_lambda2, family = "binomial")

predictions2 <- predict(final_model2, newx = test_x2, type = "response", s = best_lambda2)
predicted_classes2 <- ifelse(predictions2 > 0.5, 1, 0)
```

```{r}
conf_matrix2 <- confusionMatrix(as.factor(predicted_classes2), as.factor(test_y2))
accuracy2 <- conf_matrix2$overall['Accuracy']
precision2 <- conf_matrix2$byClass['Precision']
recall2 <- conf_matrix2$byClass['Recall']
F1_Score2 <- conf_matrix2$byClass['F1']

Class2_stats <- data.frame(Values = c(accuracy2, precision2, recall2, F1_Score2))
kable(Class2_stats, digits = 3, caption = "Class 2 Model Stats") %>% kable_styling(latex_options = "hold_position")
```

```{r}
model2_coef <- coef(final_model2, s = best_lambda2)
model2_coef_df <- as.data.frame(as.matrix(model2_coef))
highest_R2_win <- model2_coef_df %>% arrange(desc(s1)) %>% head(8)
lowest_R2_win <- model2_coef_df %>% arrange(s1) %>% head(8)
kable(list(highest_R2_win, lowest_R2_win), digits = 3, caption = "Most Important Predictors for Class 2 Red Fighter") %>% kable_styling(latex_options = "hold_position")
```




Test explanation for class 2 models 


### Class 3 Model 
```{r}
set.seed(12)

alpha_values <- seq(0, 1, by = 0.1)
cv_results3 <- lapply(alpha_values, function(alpha) {
  cv.glmnet(train_x3, train_y3, alpha = alpha, family = "binomial", type.measure = "deviance")
})

best_cv3 <- sapply(cv_results3, function(cv) min(cv$cvm))
best_alpha_index3 <- which.min(best_cv3)
best_alpha3 <- alpha_values[best_alpha_index3]
best_lambda3 <- cv_results3[[best_alpha_index3]]$lambda.min

final_model3 <- glmnet(train_x3, train_y3, alpha = best_alpha3, lambda = best_lambda3, family = "binomial")

predictions3 <- predict(final_model3, newx = test_x3, type = "response", s = best_lambda3)
predicted_classes3 <- ifelse(predictions3 > 0.5, 1, 0)
```

```{r}
conf_matrix3 <- confusionMatrix(as.factor(predicted_classes3), as.factor(test_y3))
accuracy3 <- conf_matrix3$overall['Accuracy']
precision3 <- conf_matrix3$byClass['Precision']
recall3 <- conf_matrix3$byClass['Recall']
F1_Score3 <- conf_matrix3$byClass['F1']

Class3_stats <- data.frame(Values = c(accuracy3, precision3, recall3, F1_Score3))
kable(Class3_stats, digits = 3, caption = "Class 3 Model Stats") %>% kable_styling(latex_options = "hold_position") %>% kable_styling(latex_options = "hold_position")
```

```{r}
model3_coef <- coef(final_model3, s = best_lambda3)
model3_coef_df <- as.data.frame(as.matrix(model3_coef))
highest_R3_win <- model3_coef_df %>% arrange(desc(s1)) %>% head(8)
lowest_R3_win <- model3_coef_df %>% arrange(s1) %>% head(8)
kable(list(highest_R3_win, lowest_R3_win), digits = 3, caption = "Most Important Predictors for Class 3 Red Fighter") %>% kable_styling(latex_options = "hold_position")
```


test explanation for class 3 models 


### Class 4 Model

```{r}
set.seed(12)

alpha_values <- seq(0, 1, by = 0.1)
cv_results4 <- lapply(alpha_values, function(alpha) {
  cv.glmnet(train_x4, train_y4, alpha = alpha, family = "binomial", type.measure = "deviance")
})

best_cv4 <- sapply(cv_results4, function(cv) min(cv$cvm))
best_alpha_index4 <- which.min(best_cv4)
best_alpha4 <- alpha_values[best_alpha_index4]
best_lambda4 <- cv_results4[[best_alpha_index4]]$lambda.min

final_model4 <- glmnet(train_x4, train_y4, alpha = best_alpha4, lambda = best_lambda4, family = "binomial")

predictions4 <- predict(final_model4, newx = test_x4, type = "response", s = best_lambda4)
predicted_classes4 <- ifelse(predictions4 > 0.5, 1, 0)
```

```{r}
conf_matrix4 <- confusionMatrix(as.factor(predicted_classes4), as.factor(test_y4))
accuracy4 <- conf_matrix4$overall['Accuracy']
precision4 <- conf_matrix4$byClass['Precision']
recall4 <- conf_matrix4$byClass['Recall']
F1_Score4 <- conf_matrix4$byClass['F1']
Class4_stats <- data.frame(Values = c(accuracy4, precision4, recall4, F1_Score4))
kable(Class4_stats, digits = 3, caption = "Class 4 Model Stats") %>% kable_styling(latex_options = "hold_position")
```

```{r}
model4_coef <- coef(final_model4, s = best_lambda4)
model4_coef_df <- as.data.frame(as.matrix(model4_coef))
highest_R4_win <- model4_coef_df %>% arrange(desc(s1)) %>% head(8)
lowest_R4_win <- model4_coef_df %>% arrange(s1) %>% head(8)
kable(list(highest_R4_win, lowest_R4_win), digits = 3, caption = "Most Important Predictors for Class 4 Red Fighter") %>% kable_styling(latex_options = "hold_position")
```

```{r}
model4 <- glm(WinnerRed ~ B_avg_opp_KD + B_avg_opp_SIG_STR_pct + B_avg_opp_TD_pct + B_avg_REV +
              B_avg_opp_REV + B_losses + B_win_by_Decision_Majority + B_win_by_Submission + 
                B_Reach_cms + R_avg_opp_LEG_att + R_avg_opp_LEG_landed + R_avg_opp_GROUND_att + R_avg_opp_GROUND_landed + R_win_by_Decision_Majority + R_win_by_TKO_Doctor_Stoppage + B_StanceOrthodox, data = class4_train, family = "binomial")


par(row = c(1, 1, 1, 1))
plot(model4)
```




test explanation for class 4 models


 



## Appendix 

### Data Dictionary 
R_ and B_: Prefix signifies red and blue corner fighter stats respectively

_opp_: Containing in columns is the action done by the opponent on the fighter

fighter: Name of the fighter

Referee: Referee/On-Hand Doctor of the fight. They are responsible for ending a fight if they believe a fighter is unable to continue

date: Date of the fight 

location: Location of the fight 

Winner: The corner of the winning fighter. We will turn this into a dummy variable and will serve as our model's response variable

title_bout: True/False indicator of a championship fight for a weightclass

weight_class: Categorical variable indicating the division of the fight. There are nine male divisions and four female divisons. We will reassign the male divisons to create our models 

KD: the number of knockdowns

SIG_STR: the of significant strikes 'landed of attempted'

SIG_STR_pct: significant strikes percentage

TOTAL_STR: total strikes 'landed of attempted'

TD: number of takedowns

TD_pct: takedown percentages

SUB_ATT: number of submission attempts

REV: number of reversals landed

HEAD: number significant strikes to the head (att = attempted, landed = successful attempts)

BODY: number of significant strikes to the body (att = attempted, landed = successful attempts)

LEG: number of significant strikes to the leg (att = attempted, landed = successful attempts)

CLINCH: number of significant strikes in the clinch, also known as close quarters (att = attempted, landed = successful attempts)

GROUND: number of significant strikes on the ground (att = attempted, landed = successful attempts)

Stance: the stance of the fighter (orthodox, southpaw, etc.)

Height_cms: the height of the fighter in centimeters

Reach_cms: the reach of the fighter (arm span) in centimeters

Weight_lbs: the weight of the fighter in pounds (lbs)

age: the age of the fighter

current_lose_streak: the amount of consecutive previous fights the fighter has lost (0 if they won their previous fight) 

current_win_streak: the amount of consecutive previous fights the fighter has won (0 if they lost their previous fight) 

draw: the number of draws in the fighter's ufc career

wins: the number of wins in the fighter's ufc career

losses: the number of losses in the fighter's ufc career

total_rounds_fought: the average of total rounds fought by the fighter

total_time_fought(seconds): the count of total time spent fighting in seconds

total_title_bouts: the total number of title bouts taken part in by the fighter

win_by_Decision_Majority: the number of wins by majority judges decision in the fighter's ufc career (often 2-0 with one judge deciding a draw)

win_by_Decision_Split: the number of wins by split judges decision in the fighter's ufc career (often 2-1 in favor of one fighter)

win_by_Decision_Unanimous: the number of wins by unanimous judges decision in the fighter's ufc career

win_by_KO/TKO: the number of wins by knockout in the fighter's ufc career

win_by_Submission: the number of wins by submission in the fighter's ufc career

win_by_TKO_Doctor_Stoppage: the number of wins by doctor stoppage in the fighter's ufc career


### Full Models 

```{r}
model1_coef_df <- model1_coef_df %>% filter(s1 != 0)
kable(model1_coef_df, caption = "Full Class 1 Standardized Coefficients", digits = 4)
```

```{r}
model2_coef_df <- model2_coef_df %>% filter(s1 != 0)
kable(model2_coef_df, caption = "Full Class 2 Standardized Coefficients", digits = 4)

```

```{r}
model3_coef_df <- model3_coef_df %>% filter(s1 != 0)
kable(model3_coef_df, caption = "Full Class 3 Standardized Coefficients", digits = 4)

```

```{r}
model4_coef_df <- model4_coef_df %>% filter(s1 != 0)
kable(model4_coef_df, caption = "Full Class 4 Standardized Coefficients", digits = 4)

```

